// app/tools/editing/lib/ai-export-prompt.ts
/**
 * AIè§£æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 * HTSè‡ªå‹•åˆ¤å®šçµæœã‚’å«ã‚ãŸå¸‚å ´èª¿æŸ»ãƒ‡ãƒ¼ã‚¿å–å¾—
 */

interface ProductForAI {
  id: string
  sku: string
  title: string
  title_en?: string
  english_title?: string
  price_jpy: number
  msrp?: number
  release_date?: string
  category_name?: string
  category_id?: string
  length_cm?: number
  width_cm?: number
  height_cm?: number
  weight_g?: number
  condition?: string
  image_url?: string
  brand?: string
  hts_code?: string
  hts_confidence?: string
  origin_country?: string
  material?: string
  ebay_api_data?: any
}

interface HTSAutoResult {
  productId: string
  htsCode?: string
  confidence?: string
  matchedKeywords?: string[]
  source?: string
  error?: string
}

export async function generateAIAnalysisPrompt(
  products: ProductForAI[],
  autoHTSResults?: HTSAutoResult[]
): Promise<string> {
  // CSVç”Ÿæˆ
  const headers = [
    'SKU',
    'å•†å“ID', 
    'å•†å“å(æ—¥æœ¬èª)',
    'è‹±èªã‚¿ã‚¤ãƒˆãƒ«',
    'ä»•å…¥ä¾¡æ ¼(å††)',
    'å®šä¾¡(å††)',
    'ç™ºå£²æ—¥',
    'ã‚«ãƒ†ã‚´ãƒªå',
    'ã‚«ãƒ†ã‚´ãƒªID',
    'é•·ã•(cm)',
    'å¹…(cm)',
    'é«˜ã•(cm)',
    'é‡ã•(g)',
    'çŠ¶æ…‹',
    'ç”»åƒURL',
    'ãƒ–ãƒ©ãƒ³ãƒ‰',
    'è‡ªå‹•åˆ¤å®šHTS',
    'HTSä¿¡é ¼åº¦',
    'åŸç”£å›½'
  ]
  
  const csvRows = [headers.join(',')]
  
  products.forEach(p => {
    // è‡ªå‹•åˆ¤å®šçµæœã‚’å–å¾—
    const autoResult = autoHTSResults?.find(r => r.productId === p.id)
    
    const row = [
      p.sku || '',
      p.id || '',
      `"${(p.title || '').replace(/"/g, '""')}"`,
      `"${(p.title_en || p.english_title || '').replace(/"/g, '""')}"`,
      p.price_jpy || '',
      p.msrp || p.price_jpy || '',
      p.release_date || 'ä¸æ˜',
      `"${(p.category_name || '').replace(/"/g, '""')}"`,
      p.category_id || '',
      p.length_cm || '',
      p.width_cm || '',
      p.height_cm || '',
      p.weight_g || '',
      `"${(p.condition || '').replace(/"/g, '""')}"`,
      `"${(p.image_url || '').replace(/"/g, '""')}"`,
      `"${(p.brand || '').replace(/"/g, '""')}"`,
      autoResult?.htsCode || p.hts_code || 'è¦ç¢ºèª',
      autoResult?.confidence || p.hts_confidence || 'uncertain',
      p.origin_country || ''
    ]
    csvRows.push(row.join(','))
  })
  
  const csvContent = csvRows.join('\n')
  
  // HTSè‡ªå‹•åˆ¤å®šã®å¤±æ•—å•†å“ãƒªã‚¹ãƒˆ
  const uncertainHTSProducts = products.filter((p, idx) => {
    const autoResult = autoHTSResults?.find(r => r.productId === p.id)
    const htsCode = autoResult?.htsCode || p.hts_code
    const confidence = autoResult?.confidence || p.hts_confidence
    return !htsCode || htsCode === 'è¦ç¢ºèª' || confidence === 'uncertain' || confidence === 'low'
  })

  return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– AIå•†å“åˆ†æ - å¸‚å ´èª¿æŸ» + HTSåˆ¤å®š + åŸºæœ¬æƒ…å ±å–å¾—
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ å¯¾è±¡å•†å“: ${products.length}ä»¶
${uncertainHTSProducts.length > 0 ? `âš ï¸ HTSè¦ç¢ºèªå•†å“: ${uncertainHTSProducts.length}ä»¶` : 'âœ… å…¨å•†å“ã®HTSã‚³ãƒ¼ãƒ‰è‡ªå‹•åˆ¤å®šæ¸ˆã¿'}

ä»¥ä¸‹ã®å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’**æ…é‡ã«**åˆ†æã—ã¦ãã ã•ã„ï¼š

${csvContent}

${uncertainHTSProducts.length > 0 ? `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ HTSè‡ªå‹•åˆ¤å®šå¤±æ•—ãƒªã‚¹ãƒˆï¼ˆè¦æ‰‹å‹•åˆ¤å®šï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»¥ä¸‹ã®${uncertainHTSProducts.length}å•†å“ã¯è‡ªå‹•åˆ¤å®šã«å¤±æ•—ã—ã¾ã—ãŸã€‚
å„å•†å“ã®ç‰¹å¾´ã‚’åˆ†æã—ã€æ­£ã—ã„HTSã‚³ãƒ¼ãƒ‰ã‚’åˆ¤å®šã—ã¦ãã ã•ã„ï¼š

${uncertainHTSProducts.map((p, idx) => {
  const autoResult = autoHTSResults?.find(r => r.productId === p.id)
  return `
ã€å•†å“${idx + 1}ã€‘
- SKU: ${p.sku}
- å•†å“å: ${p.title}
- ã‚«ãƒ†ã‚´ãƒª: ${p.category_name || 'ãªã—'}
- è‡ªå‹•åˆ¤å®šçµæœ: ${autoResult?.htsCode || 'å¤±æ•—'}ï¼ˆä¿¡é ¼åº¦: ${autoResult?.confidence || 'uncertain'}ï¼‰
- åˆ¤å®šå¤±æ•—ç†ç”±: ${autoResult?.error || 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãªã—'}
- å¿…è¦ãªåˆ¤æ–­ææ–™:
  * å•†å“ã®ä¸»ãªç”¨é€”ãƒ»æ©Ÿèƒ½ã¯ï¼Ÿ
  * ä¸»è¦ãªç´ æã¯ï¼Ÿï¼ˆãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã€é‡‘å±ã€ç´™ã€ç¹Šç¶­ãªã©ï¼‰
  * ç‰¹å®šã®å°‚ç”¨ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«è©²å½“ã™ã‚‹ã‹ï¼Ÿï¼ˆç©å…·ã€æ¥½å™¨ã€æ™‚è¨ˆã€ã‚«ãƒ¡ãƒ©ãªã©ï¼‰
`
}).join('\n')}

**HTSåˆ¤å®šã®å„ªå…ˆé †ä½:**
1. ã‚«ãƒ†ã‚´ãƒªãƒ¼å„ªå…ˆå“ï¼ˆ95é¡=ç©å…·ã€91é¡=æ™‚è¨ˆã€90é¡=å…‰å­¦æ©Ÿå™¨ãªã©ï¼‰
2. æ©Ÿèƒ½å„ªå…ˆå“ï¼ˆ84/85é¡=æ©Ÿæ¢°ãƒ»é›»æ°—æ©Ÿå™¨ï¼‰
3. ç´ æå„ªå…ˆå“ï¼ˆ39é¡=ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã€73é¡=é‰„é‹¼ãªã©ï¼‰

**å‚è€ƒ: ä¸»è¦HTSã‚³ãƒ¼ãƒ‰**
- 4911.91: ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ï¼ˆç´™è£½å°åˆ·ç‰©ï¼‰
- 9504.40.00.00: Playing cardsï¼ˆãƒˆãƒ©ãƒ³ãƒ—ç­‰ï¼‰
- 9503.00: ç©å…·ãƒ»ãƒ—ãƒ©ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒ•ã‚£ã‚®ãƒ¥ã‚¢
- 9006.59: ãƒ‡ã‚¸ã‚¿ãƒ«ã‚«ãƒ¡ãƒ©
- 9102.11: è…•æ™‚è¨ˆ
- 8523.49: ã‚²ãƒ¼ãƒ ã‚½ãƒ•ãƒˆï¼ˆç‰©ç†ãƒ¡ãƒ‡ã‚£ã‚¢ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
` : ''}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å‡¦ç†æ‰‹é †ï¼ˆå„ã‚¹ãƒ†ãƒƒãƒ—ã§ âœ… ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’è¡¨ç¤ºï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å„å•†å“ã«ã¤ã„ã¦ä»¥ä¸‹ã‚’é †ç•ªã«å®Ÿè¡Œã—ã€å®Œäº†ã—ãŸã‚‰å¿…ãš âœ… ã‚’è¡¨ç¤ºï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€ã‚¹ãƒ†ãƒƒãƒ—1ã€‘åŸºæœ¬å•†å“æƒ…å ±ã®å–å¾—                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… **è‹±èªã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆï¼ˆ80æ–‡å­—ä»¥å†…ã€eBay SEOæœ€é©åŒ–ï¼‰**
   - eBay/Shopee/Shopifyãªã©å¤šè²©è·¯å¯¾å¿œã®ã‚¿ã‚¤ãƒˆãƒ«
   - ä¸»è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‰æ–¹é…ç½®ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰ã€å‹ç•ªã€å•†å“ã‚¿ã‚¤ãƒ—ï¼‰
   - VEROå¯¾å¿œ: ä»¥ä¸‹ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ
     * ã€æ–°å“ç”¨ã€‘ãƒ–ãƒ©ãƒ³ãƒ‰åãªã—ç‰ˆï¼ˆä¾‹: "Anime Figure Scale 1/7 Limited Edition"ï¼‰
     * ã€ä¸­å¤ç”¨ã€‘ãƒ–ãƒ©ãƒ³ãƒ‰åã‚ã‚Šç‰ˆï¼ˆä¾‹: "Bandai One Piece Luffy Figure 1/7 Scale"ï¼‰
   
âœ… **ã‚µã‚¤ã‚ºãƒ»é‡é‡**
   - ç”»åƒãƒ»ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¨å®š
   - ä¸æ˜ãªå ´åˆã¯é¡ä¼¼å•†å“ã®å¹³å‡å€¤ã‚’ä½¿ç”¨
   
âœ… **HTSã‚³ãƒ¼ãƒ‰ï¼ˆHarmonized Tariff Scheduleï¼‰**
   ${uncertainHTSProducts.length > 0 ? `
   âš ï¸ ${uncertainHTSProducts.length}å•†å“ã¯è‡ªå‹•åˆ¤å®šå¤±æ•— - æ‰‹å‹•åˆ¤å®šãŒå¿…è¦
   
   **æ‰‹å‹•åˆ¤å®šæ‰‹é †:**
   1. å•†å“ã®ä¸»ãªç”¨é€”ãƒ»æ©Ÿèƒ½ã‚’ç‰¹å®š
   2. ä¸Šè¨˜ã®ã€ŒHTSåˆ¤å®šã®å„ªå…ˆé †ä½ã€ã«å¾“ã£ã¦åˆ†é¡
   3. hs_codesãƒ†ãƒ¼ãƒ–ãƒ«ã§è©²å½“ã™ã‚‹HTSã‚³ãƒ¼ãƒ‰ã‚’æ¤œç´¢
   4. æœ€ã‚‚é©åˆ‡ãªã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ
   ` : `
   âœ… å…¨å•†å“ã®HTSã‚³ãƒ¼ãƒ‰ã¯è‡ªå‹•åˆ¤å®šæ¸ˆã¿
   - CSVåˆ—ã€Œè‡ªå‹•åˆ¤å®šHTSã€ã®å€¤ã‚’ä½¿ç”¨
   - ä¿¡é ¼åº¦ãŒ "low" ã®å ´åˆã¯å¿µã®ãŸã‚ç¢ºèªæ¨å¥¨
   `}
   
   **âš ï¸ é‡è¦:** HTSã‚³ãƒ¼ãƒ‰ã®èª¤ã‚Šã¯èµ¤å­—ãƒªã‚¹ã‚¯ã‚ã‚Š
   - ä¸æ˜ãªå ´åˆ: "9999.99.9999" + ç†ç”±ã‚’è¨˜è¼‰
   
âœ… **åŸç”£å›½ï¼ˆå¿…ãšå®Ÿãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãï¼‰**
   âš ï¸ é‡è¦: å•†å“åã‚„ãƒ–ãƒ©ãƒ³ãƒ‰ã‹ã‚‰ã®ã€Œäºˆæƒ³ã€ã¯ç¦æ­¢
   
   **è¨±å¯ã•ã‚Œã‚‹åˆ¤å®šæ–¹æ³•:**
   1. ãƒ¡ãƒ¼ã‚«ãƒ¼å…¬å¼ã‚µã‚¤ãƒˆã§ "Made in XX" è¡¨è¨˜ã‚’ç¢ºèª
   2. å•†å“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç”»åƒã‹ã‚‰åŸç”£å›½è¡¨è¨˜ã‚’èª­ã¿å–ã‚‹
   3. Amazon/æ¥½å¤©ã®å•†å“ãƒšãƒ¼ã‚¸ã§åŸç”£å›½æƒ…å ±ã‚’ç¢ºèª
   4. ä¿¡é ¼ã§ãã‚‹å°å£²åº—ã®å•†å“èª¬æ˜ã‹ã‚‰å–å¾—
   
   **åŸç”£å›½ã‚³ãƒ¼ãƒ‰:**
   - JP: æ—¥æœ¬è£½
   - CN: ä¸­å›½è£½
   - US: ã‚¢ãƒ¡ãƒªã‚«è£½
   - KR: éŸ“å›½è£½
   - TW: å°æ¹¾è£½
   - VN: ãƒ™ãƒˆãƒŠãƒ è£½
   - "UNKNOWN": ç¢ºå®Ÿãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
   
   âŒ NGä¾‹: ã€ŒSONYã¯æ—¥æœ¬ä¼æ¥­ãªã®ã§JPã€ â†’ å®Ÿéš›ã¯ä¸­å›½è£½ã®å¯èƒ½æ€§
   âœ… OKä¾‹: ã€ŒAmazonå•†å“ãƒšãƒ¼ã‚¸ã«'Made in China'ã®è¨˜è¼‰ç¢ºèª â†’ CNã€
   
âœ… **é–¢ç¨ç‡å–å¾—**
   - customs_dutiesãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰HTSã‚³ãƒ¼ãƒ‰ + åŸç”£å›½ã§å–å¾—
   - åŸç”£å›½ãŒ "UNKNOWN" ã®å ´åˆ: æœ€é«˜ç¨ç‡ã‚’é©ç”¨ï¼ˆå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€ã‚¹ãƒ†ãƒƒãƒ—2ã€‘å¸‚å ´èª¿æŸ»ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ç”¨ï¼‰â­ é‡è¦        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… **â‘  æ—¥æœ¬å›½å†…ã®ç›¸å ´ãƒ»å“è–„æƒ…å ±ï¼ˆF_Price_Premiumï¼‰**
   ã€èª¿æŸ»å…ˆã€‘ãƒ¡ãƒ«ã‚«ãƒªã€ãƒ¤ãƒ•ã‚ªã‚¯ã€Amazon Japanã€æ¥½å¤©å¸‚å ´
   
   **æ‰‹é †:**
   1. å„ã‚µã‚¤ãƒˆã§å•†å“åã§æ¤œç´¢
   2. ç›´è¿‘1ãƒ¶æœˆã®å–å¼•ä¾¡æ ¼ã®å¹³å‡ã‚’ç®—å‡º
   3. å®šä¾¡ã¨æ¯”è¼ƒã—ã¦ãƒ—ãƒ¬ãƒŸã‚¢ç‡ã‚’è¨ˆç®—
   
   **è¨ˆç®—å¼:**
   \`\`\`
   ãƒ—ãƒ¬ãƒŸã‚¢ç‡(%) = (ç¾åœ¨ã®å¹³å‡å–å¼•ä¾¡æ ¼ / å®šä¾¡) Ã— 100
   \`\`\`

âœ… **â‘¡ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®è©±é¡Œæ€§ï¼ˆF_Community_Scoreï¼‰**
   ã€èª¿æŸ»å…ˆã€‘Redditã€Twitter(X)ã€å°‚é–€ãƒ›ãƒ“ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ©ãƒ 
   
   **è©•ä¾¡åŸºæº–ï¼ˆ10ç‚¹æº€ç‚¹ï¼‰:**
   - 10ç‚¹: ãƒã‚¤ãƒ©ãƒ«ã€å¤§é‡ã®è‚¯å®šçš„è¨€åŠ
   - 8-9ç‚¹: æ´»ç™ºãªè­°è«–ã€é«˜è©•ä¾¡å¤šæ•°
   - 6-7ç‚¹: ä¸€å®šã®èªçŸ¥åº¦ã€è‚¯å®šçš„æ„è¦‹å„ªå‹¢
   - 4-5ç‚¹: å°‘æ•°ã®è¨€åŠã€ä¸­ç«‹çš„
   - 1-3ç‚¹: ã»ã¼è¨€åŠãªã—ã€ã¾ãŸã¯ãƒã‚¬ãƒ†ã‚£ãƒ–
   - 0ç‚¹: å…¨ãè¨€åŠãªã—

âœ… **â‘¢ æ—¥æœ¬å¸‚å ´å…¨ä½“ã®æµé€šé‡ï¼ˆC_Supply_Japanï¼‰**
   ã€èª¿æŸ»å…ˆã€‘Amazon Japanã€ãƒ¤ãƒ•ã‚ªã‚¯ã€ãƒ¡ãƒ«ã‚«ãƒªã€ä¸»è¦ãƒ›ãƒ“ãƒ¼åº—
   
   **ã‚«ã‚¦ãƒ³ãƒˆæ–¹æ³•:**
   - ç¾åœ¨ã®å‡ºå“æ•°ã‚’åˆç®—
   - åœ¨åº«ã‚ã‚Šã®åº—èˆ—æ•°ã‚‚ã‚«ã‚¦ãƒ³ãƒˆ

âœ… **â‘£ ãƒ¡ãƒ¼ã‚«ãƒ¼ã®ç”Ÿç”£è¨ˆç”»ï¼ˆS_Flag_Discontinuedï¼‰**
   ã€èª¿æŸ»å…ˆã€‘ãƒ¡ãƒ¼ã‚«ãƒ¼å…¬å¼ã‚µã‚¤ãƒˆã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªãƒªãƒ¼ã‚¹ã€æ¥­ç•Œãƒ‹ãƒ¥ãƒ¼ã‚¹
   
   **åˆ¤å®šåŸºæº–:**
   - \`discontinued\`: ç”Ÿç”£çµ‚äº†ãƒ»å»ƒç›¤ç¢ºå®š
   - \`limited\`: é™å®šç”Ÿç”£ï¼ˆå†ç”Ÿç”£ãªã—ï¼‰
   - \`restock_scheduled\`: å†è²©äºˆå®šã‚ã‚Š
   - \`in_production\`: é€šå¸¸ç”Ÿç”£ä¸­
   - \`unknown\`: æƒ…å ±ãªã—

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONé…åˆ—ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å„å•†å“ã«ã¤ã„ã¦ä»¥ä¸‹ã®JSONå½¢å¼ã§è¿”ç­”ã—ã¦ãã ã•ã„ï¼š

\`\`\`json
[
  {
    "product_id": "å•†å“UUID",
    "sku": "SKU",
    "status": "âœ… å‡¦ç†å®Œäº†" ã¾ãŸã¯ "âš ï¸ ä¸€éƒ¨ãƒ‡ãƒ¼ã‚¿ä¸è¶³",
    
    "basic_info": {
      "title_en_new": "è‹±èªã‚¿ã‚¤ãƒˆãƒ«ï¼ˆæ–°å“ãƒ»VEROå¯¾å¿œãƒ–ãƒ©ãƒ³ãƒ‰åãªã—ç‰ˆï¼‰",
      "title_en_used": "è‹±èªã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¸­å¤ç”¨ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰åã‚ã‚Šç‰ˆï¼‰",
      "hts_code": "HTSã‚³ãƒ¼ãƒ‰",
      "hts_confidence": "high/medium/low/uncertain",
      "hts_source": "autoï¼ˆè‡ªå‹•åˆ¤å®šï¼‰ã¾ãŸã¯ manualï¼ˆæ‰‹å‹•åˆ¤å®šï¼‰",
      "hts_description": "HTSã‚³ãƒ¼ãƒ‰èª¬æ˜",
      "origin_country": "åŸç”£å›½ã‚³ãƒ¼ãƒ‰",
      "origin_source": "åŸç”£å›½ã®ç¢ºèªå…ƒï¼ˆURLã¾ãŸã¯æƒ…å ±æºï¼‰",
      "customs_rate": é–¢ç¨ç‡(%),
      "length_cm": é•·ã•,
      "width_cm": å¹…,
      "height_cm": é«˜ã•,
      "weight_g": é‡ã•
    },
    
    "market_research": {
      "f_price_premium": ãƒ—ãƒ¬ãƒŸã‚¢ç‡(%),
      "f_community_score": ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¹ã‚³ã‚¢(0-10),
      "c_supply_japan": æ—¥æœ¬å¸‚å ´æµé€šé‡(ä»¶æ•°),
      "c_supply_trend": "increasing/stable/decreasing/unknown",
      "s_flag_discontinued": "discontinued/limited/restock_scheduled/in_production/unknown"
    },
    
    "data_completion": {
      "hts": true/false,
      "origin": true/false,
      "market_price": true/false,
      "community": true/false,
      "supply": true/false
    },
    
    "notes": "ç‰¹è¨˜äº‹é …ã‚„æ³¨æ„ç‚¹"
  }
]
\`\`\`

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ å‡¦ç†é–‹å§‹ - è‡ªå‹•å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš¡ **é‡è¦: å…¨å•†å“ã®åˆ†æå®Œäº†å¾Œã€Supabaseç›´æ¥æ›´æ–°ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¦ãã ã•ã„**

MCPãƒ„ãƒ¼ãƒ« \`supabase\` ã‚’ä½¿ç”¨ã—ã€å„å•†å“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ \`products\` ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ›´æ–°:

\`\`\`sql
UPDATE products
SET 
  title_en = '[ç”Ÿæˆã—ãŸè‹±èªã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¸­å¤ç”¨ï¼‰]',
  hts_code = '[HTSã‚³ãƒ¼ãƒ‰]',
  hts_confidence = '[ä¿¡é ¼åº¦]',
  origin_country = '[åŸç”£å›½]',
  length_cm = [é•·ã•],
  width_cm = [å¹…],
  height_cm = [é«˜ã•],
  weight_g = [é‡ã•],
  listing_data = listing_data || jsonb_build_object(
    'ai_market_research', jsonb_build_object(
      'f_price_premium', [ãƒ—ãƒ¬ãƒŸã‚¢ç‡],
      'f_community_score', [ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¹ã‚³ã‚¢],
      'c_supply_japan', [å›½å†…æµé€šé‡],
      's_flag_discontinued', '[å»ƒç›¤çŠ¶æ³]',
      'last_updated', NOW()
    ),
    'title_en_new', '[æ–°å“ç”¨ã‚¿ã‚¤ãƒˆãƒ«]',
    'title_en_used', '[ä¸­å¤ç”¨ã‚¿ã‚¤ãƒˆãƒ«]'
  )
WHERE id = '[å•†å“UUID]';
\`\`\`

æ›´æ–°å®Œäº†å¾Œã€ã€Œâœ… Supabaseæ›´æ–°å®Œäº†: {ä»¶æ•°}ä»¶ã€ã¨è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
`
}

// åŒæœŸç‰ˆï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
export function generateAIAnalysisPromptSync(products: ProductForAI[]): string {
  // è‡ªå‹•HTSåˆ¤å®šãªã—ã§ç”Ÿæˆ
  const headers = [
    'SKU', 'å•†å“ID', 'å•†å“å(æ—¥æœ¬èª)', 'è‹±èªã‚¿ã‚¤ãƒˆãƒ«', 'ä»•å…¥ä¾¡æ ¼(å††)',
    'å®šä¾¡(å††)', 'ç™ºå£²æ—¥', 'ã‚«ãƒ†ã‚´ãƒªå', 'ã‚«ãƒ†ã‚´ãƒªID', 
    'é•·ã•(cm)', 'å¹…(cm)', 'é«˜ã•(cm)', 'é‡ã•(g)', 'çŠ¶æ…‹', 'ç”»åƒURL', 'ãƒ–ãƒ©ãƒ³ãƒ‰'
  ]
  
  const csvRows = [headers.join(',')]
  
  products.forEach(p => {
    const row = [
      p.sku || '',
      p.id || '',
      `"${(p.title || '').replace(/"/g, '""')}"`,
      `"${(p.title_en || p.english_title || '').replace(/"/g, '""')}"`,
      p.price_jpy || '',
      p.msrp || p.price_jpy || '',
      p.release_date || 'ä¸æ˜',
      `"${(p.category_name || '').replace(/"/g, '""')}"`,
      p.category_id || '',
      p.length_cm || '',
      p.width_cm || '',
      p.height_cm || '',
      p.weight_g || '',
      `"${(p.condition || '').replace(/"/g, '""')}"`,
      `"${(p.image_url || '').replace(/"/g, '""')}"`,
      `"${(p.brand || '').replace(/"/g, '""')}"`
    ]
    csvRows.push(row.join(','))
  })
  
  const csvContent = csvRows.join('\n')
  
  return `ã€ç°¡æ˜“ç‰ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€‘\n${csvContent}\n\nâ€» HTSè‡ªå‹•åˆ¤å®šã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€å¸‚å ´èª¿æŸ»ãƒ¢ãƒ¼ãƒ€ãƒ«ã‹ã‚‰ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚`
}
