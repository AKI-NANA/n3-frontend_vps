{
  "name": "N3-52-ãƒ¡ãƒ‡ã‚£ã‚¢-Remotionå‹•ç”»ç”Ÿæˆ-YouTubeæŠ•ç¨¿-V5-PRODUCTION",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "video-generate",
        "options": {
          "responseMode": "responseNode"
        }
      },
      "id": "webhook",
      "name": "Webhook: video-generate",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "webhookId": "video-generate"
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body || $input.first().json || {};\nconst apiUrl = $env.N3_API_URL || '{{$env.GATEWAY_URL}}';\nconst remotionUrl = $env.REMOTION_API_URL || 'http://localhost:3100';\nconst n8nUrl = $env.N8N_URL || '{{$env.N8N_BASE_URL}}';\n\nconst productId = body.product_id;\nconst videoType = body.video_type || 'youtube_short';\nconst autoPublish = body.auto_publish || false;\nconst generateVoice = body.generate_voice !== false;\nconst genre = body.genre || 'general';\n\nif (!productId) {\n  return [{ json: { error: true, message: 'product_id ã¯å¿…é ˆ', code: 'MISSING_PARAM' } }];\n}\n\nreturn [{ json: { product_id: productId, video_type: videoType, auto_publish: autoPublish, generate_voice: generateVoice, genre: genre, api_url: apiUrl, remotion_url: remotionUrl, n8n_url: n8nUrl } }];"
      },
      "id": "init",
      "name": "ðŸ” åˆæœŸåŒ–",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "error-check",
              "leftValue": "={{ $json.error }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "check-error",
      "name": "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: false, error: $json.message }) }}",
        "options": {
          "responseCode": 400
        }
      },
      "id": "respond-error",
      "name": "ã‚¨ãƒ©ãƒ¼å¿œç­”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT pm.*, pm.title_en, pm.description_en, im.purchase_price, im.image_url AS inv_image_url FROM products_master pm LEFT JOIN inventory_master im ON pm.id = im.product_id WHERE pm.id = $1",
        "options": {
          "queryParams": "={{ [$json.product_id] }}"
        }
      },
      "id": "get-product",
      "name": "ðŸ“¦ å•†å“å–å¾—",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node['ðŸ” åˆæœŸåŒ–'].json.api_url }}/api/ai/generate-script",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ product_title: $json[0]?.title || $json.title, product_description: $json[0]?.description || $json.description, video_type: $node['ðŸ” åˆæœŸåŒ–'].json.video_type, language: 'ja', duration: $node['ðŸ” åˆæœŸåŒ–'].json.video_type === 'youtube_short' ? 60 : 300, genre: $node['ðŸ” åˆæœŸåŒ–'].json.genre }) }}",
        "options": {
          "timeout": 60000
        }
      },
      "id": "generate-script",
      "name": "ðŸ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const config = $node['ðŸ” åˆæœŸåŒ–'].json;\nconst productRaw = $node['ðŸ“¦ å•†å“å–å¾—'].json;\nconst scriptResult = $input.first().json;\nconst product = Array.isArray(productRaw) ? productRaw[0] : productRaw;\n\nif (!product) return [{ json: { error: true, message: 'å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' } }];\n\nconst script = scriptResult.script || scriptResult.text || `${product.title}ã®ç´¹ä»‹å‹•ç”»ã§ã™ã€‚æ—¥æœ¬ã‹ã‚‰ãŠå±Šã‘ã™ã‚‹é«˜å“è³ªãªå•†å“ã‚’ãœã²ã”è¦§ãã ã•ã„ã€‚`;\nconst scenes = scriptResult.scenes || [\n  { duration: 3, type: 'title', text: product.title },\n  { duration: 5, type: 'image', image_url: product.image_url || product.inv_image_url },\n  { duration: 7, type: 'text', text: script.substring(0, 100) },\n  { duration: 3, type: 'cta', text: 'æ¦‚è¦æ¬„ã®ãƒªãƒ³ã‚¯ã‹ã‚‰è³¼å…¥ã§ãã¾ã™' }\n];\n\nreturn [{ json: { product_id: product.id, product_title: product.title, product_description: product.description, image_url: product.image_url || product.inv_image_url, price: product.price_inc_vat || product.price, script: script, scenes: scenes, video_type: config.video_type, auto_publish: config.auto_publish, generate_voice: config.generate_voice, genre: config.genre, remotion_url: config.remotion_url, n8n_url: config.n8n_url } }];"
      },
      "id": "process-script",
      "name": "ðŸ“‹ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‡¦ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "generate-voice",
              "leftValue": "={{ $json.generate_voice }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "check-voice",
      "name": "éŸ³å£°ç”Ÿæˆï¼Ÿ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.n8n_url }}/webhook/voice-generate",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ text: $json.script, product_id: $json.product_id, genre: $json.genre, language: 'ja', add_breath: true }) }}",
        "options": {
          "timeout": 180000
        }
      },
      "id": "generate-voice",
      "name": "ðŸŽ™ï¸ ElevenLabséŸ³å£°ç”Ÿæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nreturn [{ json: { ...data, audio_url: null, audio_duration: null } }];"
      },
      "id": "skip-voice",
      "name": "ã‚¹ã‚­ãƒƒãƒ—",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "const prevData = $node['ðŸ“‹ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‡¦ç†'].json;\nconst voiceResult = $input.first().json;\nconst audioUrl = voiceResult.audio_url || null;\nconst audioDuration = voiceResult.duration_seconds || null;\nconst compositionId = prevData.video_type === 'youtube_short' ? 'ShortVideo' : 'LongVideo';\n\nconst remotionProps = {\n  compositionId: compositionId,\n  inputProps: {\n    title: prevData.product_title,\n    description: prevData.product_description,\n    script: prevData.script,\n    imageUrl: prevData.image_url,\n    audioUrl: audioUrl,\n    audioDuration: audioDuration,\n    scenes: prevData.scenes,\n    product: { price: prevData.price, currency: 'USD' },\n    style: { primaryColor: '#ff6b35', accentColor: '#fbbf24', fontFamily: 'Noto Sans JP', seed: prevData.product_id }\n  },\n  codec: 'h264',\n  imageFormat: 'jpeg'\n};\n\nreturn [{ json: { ...prevData, audio_url: audioUrl, audio_duration: audioDuration, remotion_props: remotionProps } }];"
      },
      "id": "prepare-remotion",
      "name": "ðŸŽ¬ Remotionæº–å‚™",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.remotion_url }}/api/render",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.remotion_props) }}",
        "options": {
          "timeout": 600000
        }
      },
      "id": "render-video",
      "name": "ðŸŽ¥ å‹•ç”»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const prepData = $node['ðŸŽ¬ Remotionæº–å‚™'].json;\nconst renderResult = $input.first().json;\nconst videoUrl = renderResult.outputUrl || renderResult.url || renderResult.videoUrl || null;\nconst renderId = renderResult.renderId || renderResult.id || 'mock-render-' + Date.now();\nconst renderStatus = videoUrl ? 'completed' : (renderResult.error ? 'error' : 'pending');\nreturn [{ json: { ...prepData, video_url: videoUrl, render_id: renderId, render_status: renderStatus, render_error: renderResult.error || null } }];"
      },
      "id": "process-render",
      "name": "ðŸ“‹ ãƒ¬ãƒ³ãƒ€ãƒ¼å‡¦ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "auto-publish",
              "leftValue": "={{ $json.auto_publish && $json.video_url }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "check-publish",
      "name": "è‡ªå‹•æŠ•ç¨¿ï¼Ÿ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯ï¼ˆYouTubeæŠ•ç¨¿å‰ï¼‰\n// GeminiæŒ‡ç¤ºæ›¸æº–æ‹ : ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã‚’5åˆ†å‰ã«ãƒã‚§ãƒƒã‚¯ã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥\n// ============================================================================\n\nconst data = $input.first().json;\nconst n8nUrl = $env.N8N_URL || '{{$env.N8N_BASE_URL}}';\n\n// DBã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ã‚’è©¦ã¿ã‚‹ï¼ˆyoutube_tokensãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\nlet needsRefresh = false;\nlet accessToken = $env.YOUTUBE_ACCESS_TOKEN || null;\nlet tokenExpiresAt = null;\n\ntry {\n  // ç’°å¢ƒå¤‰æ•°ã«æœ‰åŠ¹æœŸé™ãŒãªã„å ´åˆã¯ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æŽ¨å¥¨\n  if (!accessToken) {\n    needsRefresh = true;\n  } else {\n    // ä¸€èˆ¬çš„ã«YouTube OAuthãƒˆãƒ¼ã‚¯ãƒ³ã¯1æ™‚é–“æœ‰åŠ¹\n    // å®‰å…¨ã®ãŸã‚ã€å¸¸ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚µãƒ–ãƒ•ãƒ­ãƒ¼ã‚’å‘¼ã³å‡ºã—ã€æœ€æ–°ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—\n    needsRefresh = true; // å¸¸ã«æœ€æ–°ã‚’å–å¾—ã™ã‚‹å®‰å…¨è¨­è¨ˆ\n  }\n} catch (e) {\n  needsRefresh = true;\n}\n\nreturn [{ json: { ...data, needs_token_refresh: needsRefresh, current_token: accessToken, n8n_url: n8nUrl } }];"
      },
      "id": "oauth-precheck",
      "name": "ðŸ”‘ OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "needs-refresh",
              "leftValue": "={{ $json.needs_token_refresh }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "check-token-refresh",
      "name": "ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¿…è¦ï¼Ÿ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.n8n_url }}/webhook/youtube-refresh-token",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ force: true }) }}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "refresh-token",
      "name": "ðŸ”„ ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥çµæžœã‚’ãƒžãƒ¼ã‚¸\nconst prevData = $node['ðŸ”‘ OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯'].json;\nconst refreshResult = $input.first().json;\n\n// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æˆåŠŸæ™‚ã¯æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨\nconst newToken = refreshResult.access_token || refreshResult.token || prevData.current_token;\nconst refreshSuccess = !!refreshResult.access_token || !!refreshResult.token;\n\nreturn [{ json: { ...prevData, youtube_access_token: newToken, token_refresh_success: refreshSuccess } }];"
      },
      "id": "process-refresh",
      "name": "ðŸ“‹ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¹ã‚­ãƒƒãƒ—æ™‚ã¯ç¾åœ¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨\nconst data = $input.first().json;\nreturn [{ json: { ...data, youtube_access_token: data.current_token || $env.YOUTUBE_ACCESS_TOKEN, token_refresh_success: false } }];"
      },
      "id": "skip-refresh",
      "name": "ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.googleapis.com/upload/youtube/v3/videos?uploadType=resumable&part=snippet,status",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $json.youtube_access_token }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ snippet: { title: $json.product_title + ' - ' + ($json.video_type === 'youtube_short' ? '#Shorts' : 'å•†å“ç´¹ä»‹'), description: $json.script.substring(0, 500) + '\\n\\nðŸ›’ è³¼å…¥ã¯ã“ã¡ã‚‰: æ¦‚è¦æ¬„ã®ãƒªãƒ³ã‚¯ã‹ã‚‰', tags: ['Japanese products', 'N3 Global', 'æ—¥æœ¬è£½', 'Quality'], categoryId: '22' }, status: { privacyStatus: 'public', selfDeclaredMadeForKids: false } }) }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "youtube-upload",
      "name": "ðŸ“º YouTubeæŠ•ç¨¿",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const prevData = $node['ðŸ“‹ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†']?.json || $node['ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥']?.json || {};\nconst youtubeResult = $input.first().json;\nconst youtubeId = youtubeResult.id || null;\nreturn [{ json: { ...prevData, youtube_id: youtubeId, publish_status: youtubeId ? 'published' : 'draft' } }];"
      },
      "id": "process-youtube",
      "name": "ðŸ“‹ YouTubeå‡¦ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nreturn [{ json: { ...data, youtube_id: null, publish_status: 'draft' } }];"
      },
      "id": "skip-publish",
      "name": "ã‚¹ã‚­ãƒƒãƒ—æŠ•ç¨¿",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO media_content (product_id, content_type, title, script, audio_url, media_url, platform_id, publish_status, render_status, metadata) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) ON CONFLICT (product_id, content_type) DO UPDATE SET title = EXCLUDED.title, script = EXCLUDED.script, audio_url = EXCLUDED.audio_url, media_url = EXCLUDED.media_url, platform_id = EXCLUDED.platform_id, publish_status = EXCLUDED.publish_status, render_status = EXCLUDED.render_status, metadata = EXCLUDED.metadata, updated_at = NOW() RETURNING id",
        "options": {
          "queryParams": "={{ [$json.product_id, $json.video_type, $json.product_title, $json.script, $json.audio_url, $json.video_url, $json.youtube_id, $json.publish_status, $json.render_status, JSON.stringify({ render_id: $json.render_id, genre: $json.genre, scenes: $json.scenes })] }}"
        }
      },
      "id": "save-content",
      "name": "ðŸ’¾ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¿å­˜",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const data = $node['ðŸ“‹ ãƒ¬ãƒ³ãƒ€ãƒ¼å‡¦ç†'].json;\nconst youtubeData = $node['ðŸ“‹ YouTubeå‡¦ç†']?.json || $node['ã‚¹ã‚­ãƒƒãƒ—æŠ•ç¨¿']?.json || {};\nconst saveResult = $input.first().json;\nreturn [{ json: { success: true, content_id: saveResult?.id || saveResult?.[0]?.id, product_id: data.product_id, video_type: data.video_type, video_url: data.video_url, audio_url: data.audio_url, youtube_id: youtubeData.youtube_id, publish_status: youtubeData.publish_status || 'draft', render_status: data.render_status } }];"
      },
      "id": "format-response",
      "name": "ðŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "respond-success",
      "name": "âœ… æˆåŠŸå¿œç­”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "jsCode": "// ðŸ” HMAC SHA256 ç½²åæ¤œè¨¼ (Empire OS v6)\nconst crypto = require('crypto');\n\nconst signature = $request.headers['x-n3-signature'] || $request.headers['X-N3-Signature'];\nconst timestamp = $request.headers['x-n3-timestamp'] || $request.headers['X-N3-Timestamp'];\nconst secret = $env.N8N_HMAC_SECRET;\n\nif (!secret) {\n  throw new Error('ðŸš« N8N_HMAC_SECRET ç’°å¢ƒå¤‰æ•°ãŒæœªè¨­å®šã§ã™');\n}\n\nif (!signature || !timestamp) {\n  throw new Error('ðŸš« ç½²åã¾ãŸã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæ¬ è½ã—ã¦ã„ã¾ã™');\n}\n\n// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ (5åˆ†)\nconst now = Date.now();\nconst tsAge = now - parseInt(timestamp);\nif (tsAge > 300000 || tsAge < -30000) {\n  throw new Error('ðŸš« ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæœŸé™åˆ‡ã‚Œã¾ãŸã¯ä¸æ­£ã§ã™');\n}\n\n// HMACæ¤œè¨¼\nconst bodyString = JSON.stringify($json);\nconst computedHmac = crypto\n  .createHmac('sha256', secret)\n  .update(timestamp + '.' + bodyString)\n  .digest('hex');\n\nif (signature !== computedHmac) {\n  throw new Error('ðŸš« HMACç½²åæ¤œè¨¼å¤±æ•—: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ');\n}\n\n// æ¤œè¨¼æˆåŠŸ - å…ƒãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è¿”ã™\nreturn [{ json: $json }];"
      },
      "name": "ðŸ” HMACç½²åæ¤œè¨¼",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[EMPIRE_OS_V6] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åˆ¶æŒ¿å…¥"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{$env.SUPABASE_URL}}/rest/v1/execution_logs",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{$env.SUPABASE_ANON_KEY}}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{$env.SUPABASE_SERVICE_ROLE_KEY}}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"workflow_id\": \"{{$workflow.id}}\",\n  \"workflow_name\": \"{{$workflow.name}}\",\n  \"status\": \"success\",\n  \"execution_time_ms\": {{Date.now() - $execution.startedAt.getTime()}},\n  \"error_message\": null,\n  \"executed_at\": \"{{new Date().toISOString()}}\",\n  \"node_count\": {{$workflow.nodes.length}},\n  \"metadata\": {}\n}"
      },
      "name": "ðŸ“Š å®Ÿè¡Œãƒ­ã‚°é€ä¿¡ (æˆåŠŸ)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true,
      "notes": "[EMPIRE_OS_V6] ä¸­å¤®ç›£è¦–ãƒ‘ãƒ«ã‚¹"
    }
  ],
  "connections": {
    "Webhook: video-generate": {
      "main": [
        [
          {
            "node": "ðŸ” HMACç½²åæ¤œè¨¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ” åˆæœŸåŒ–": {
      "main": [
        [
          {
            "node": "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [
          {
            "node": "ã‚¨ãƒ©ãƒ¼å¿œç­”",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ðŸ“¦ å•†å“å–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“¦ å•†å“å–å¾—": {
      "main": [
        [
          {
            "node": "ðŸ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "ðŸ“‹ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“‹ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‡¦ç†": {
      "main": [
        [
          {
            "node": "éŸ³å£°ç”Ÿæˆï¼Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "éŸ³å£°ç”Ÿæˆï¼Ÿ": {
      "main": [
        [
          {
            "node": "ðŸŽ™ï¸ ElevenLabséŸ³å£°ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ã‚¹ã‚­ãƒƒãƒ—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸŽ™ï¸ ElevenLabséŸ³å£°ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "ðŸŽ¬ Remotionæº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¹ã‚­ãƒƒãƒ—": {
      "main": [
        [
          {
            "node": "ðŸŽ¬ Remotionæº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸŽ¬ Remotionæº–å‚™": {
      "main": [
        [
          {
            "node": "ðŸŽ¥ å‹•ç”»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸŽ¥ å‹•ç”»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°": {
      "main": [
        [
          {
            "node": "ðŸ“‹ ãƒ¬ãƒ³ãƒ€ãƒ¼å‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“‹ ãƒ¬ãƒ³ãƒ€ãƒ¼å‡¦ç†": {
      "main": [
        [
          {
            "node": "è‡ªå‹•æŠ•ç¨¿ï¼Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è‡ªå‹•æŠ•ç¨¿ï¼Ÿ": {
      "main": [
        [
          {
            "node": "ðŸ”‘ OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ã‚¹ã‚­ãƒƒãƒ—æŠ•ç¨¿",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ”‘ OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [
          {
            "node": "ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¿…è¦ï¼Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¿…è¦ï¼Ÿ": {
      "main": [
        [
          {
            "node": "ðŸ”„ ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ”„ ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥": {
      "main": [
        [
          {
            "node": "ðŸ“‹ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“‹ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†": {
      "main": [
        [
          {
            "node": "ðŸ“º YouTubeæŠ•ç¨¿",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥": {
      "main": [
        [
          {
            "node": "ðŸ“º YouTubeæŠ•ç¨¿",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“º YouTubeæŠ•ç¨¿": {
      "main": [
        [
          {
            "node": "ðŸ“‹ YouTubeå‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“‹ YouTubeå‡¦ç†": {
      "main": [
        [
          {
            "node": "ðŸ’¾ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¿å­˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¹ã‚­ãƒƒãƒ—æŠ•ç¨¿": {
      "main": [
        [
          {
            "node": "ðŸ’¾ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¿å­˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ’¾ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¿å­˜": {
      "main": [
        [
          {
            "node": "ðŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹": {
      "main": [
        [
          {
            "node": "âœ… æˆåŠŸå¿œç­”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ” HMACç½²åæ¤œè¨¼": {
      "main": [
        [
          {
            "node": "ðŸ” åˆæœŸåŒ–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionTimeout": 900,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  },
  "tags": [
    {
      "name": "N3-Media",
      "color": "#e74c3c"
    },
    {
      "name": "V5-PRODUCTION",
      "color": "#00ff00"
    },
    {
      "name": "Remotion",
      "color": "#9b59b6"
    },
    {
      "name": "YouTube",
      "color": "#ff0000"
    },
    {
      "name": "ElevenLabs",
      "color": "#3498db"
    },
    {
      "name": "OAuth-Enhanced",
      "color": "#f1c40f"
    },
    {
      "name": "Empire-OS-V6",
      "color": "#ff4500"
    }
  ],
  "active": false,
  "meta": {
    "description": "N3-52 Remotionå‹•ç”»ç”Ÿæˆ + YouTubeæŠ•ç¨¿ V5-PRODUCTION - OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯è¿½åŠ ç‰ˆ",
    "version": "5.1",
    "changelog": "2026-01-20: OAuthäº‹å‰ãƒã‚§ãƒƒã‚¯ãƒŽãƒ¼ãƒ‰è¿½åŠ ï¼ˆGeminiæŒ‡ç¤ºæ›¸æº–æ‹ ï¼‰",
    "gemini_requirements_met": [
      "oauth_auto_refresh",
      "token_precheck"
    ]
  }
}