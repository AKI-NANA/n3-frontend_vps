{
  "name": "ã€å¸ä»¤å¡”ã€‘05_144-é˜²è¡›-PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†-ç‰©ç†SIMãƒ•ã‚¡ãƒ¼ãƒ é€£æº-åˆ†æ•£ãƒªã‚«ãƒãƒª_V5",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "pva-manage",
        "options": {
          "responseMode": "responseNode"
        }
      },
      "name": "Webhook: pva-manage",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "webhookId": "pva-manage"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "name": "â° 6æ™‚é–“ã”ã¨å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç† åˆæœŸåŒ–\n// Phone Verified Accounts ã®ç™»éŒ²ãƒ»ç®¡ç†ãƒ»å¾©æ—§\n// ============================================================================\n\nconst body = $input.first().json.body || $input.first().json || {};\n\n// action: 'list', 'register', 'verify', 'health_check', 'recovery', 'assign_profile'\nconst action = body.action || 'list';\nconst accountId = body.account_id;\nconst clusterId = body.cluster_id; // ãƒªã‚«ãƒãƒªãƒ„ãƒªãƒ¼ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ID\nconst status = body.status; // 'active', 'suspended', 'banned', 'recovery'\n\n// æ–°è¦ç™»éŒ²ç”¨\nconst newAccount = body.new_account;\n// { google_email, google_password, recovery_email, phone_number, sim_slot_id }\n\nreturn [{\n  json: {\n    action: action,\n    account_id: accountId,\n    cluster_id: clusterId,\n    status_filter: status,\n    new_account: newAccount,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "name": "ğŸ”§ åˆæœŸåŒ–",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true
          },
          "conditions": [
            {
              "id": "action",
              "leftValue": "={{ $json.action }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ]
        }
      },
      "name": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†å²",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "options": {
        "fallbackOutput": "none",
        "rules": [
          {
            "output": 0,
            "value": "list"
          },
          {
            "output": 1,
            "value": "register"
          },
          {
            "output": 2,
            "value": "health_check"
          },
          {
            "output": 3,
            "value": "recovery"
          },
          {
            "output": 4,
            "value": "assign_profile"
          }
        ]
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT pa.*, rc.cluster_name, ap.profile_name, ap.provider as antidetect_provider, mpp.proxy_host FROM pva_accounts pa LEFT JOIN recovery_clusters rc ON pa.cluster_id = rc.id LEFT JOIN antidetect_profiles ap ON pa.antidetect_profile_id = ap.id LEFT JOIN mobile_proxy_pool mpp ON pa.proxy_id = mpp.id WHERE ($1::text IS NULL OR pa.status = $1) AND ($2::int IS NULL OR pa.cluster_id = $2) ORDER BY pa.created_at DESC",
        "options": {
          "queryParams": "={{ [$json.status_filter, $json.cluster_id] }}"
        }
      },
      "name": "ğŸ“¥ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§å–å¾—",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// æ–°è¦PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²\n// ãƒªã‚«ãƒãƒªã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ã®è‡ªå‹•å‰²ã‚Šå½“ã¦\n// ============================================================================\n\nconst config = $input.first().json;\nconst newAccount = config.new_account;\n\nif (!newAccount || !newAccount.google_email) {\n  return [{ json: { success: false, error: 'google_emailã¯å¿…é ˆã§ã™' } }];\n}\n\n// ãƒªã‚«ãƒãƒªã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®è‡ªå‹•é¸æŠï¼ˆæœ€ã‚‚ç©ºã„ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼‰\n// 10ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã”ã¨ã«1ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒæ¨å¥¨\nreturn [{\n  json: {\n    ...config,\n    account_data: {\n      google_email: newAccount.google_email,\n      google_password_encrypted: newAccount.google_password, // æš—å·åŒ–å‡¦ç†ã¯åˆ¥é€”\n      recovery_email: newAccount.recovery_email,\n      phone_number: newAccount.phone_number,\n      sim_slot_id: newAccount.sim_slot_id,\n      status: 'active',\n      trust_score: 100 // åˆæœŸä¿¡é ¼ã‚¹ã‚³ã‚¢\n    }\n  }\n}];"
      },
      "name": "ğŸ“‹ ç™»éŒ²ãƒ‡ãƒ¼ã‚¿æº–å‚™",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT id FROM recovery_clusters WHERE (SELECT COUNT(*) FROM pva_accounts WHERE cluster_id = recovery_clusters.id) < 10 ORDER BY (SELECT COUNT(*) FROM pva_accounts WHERE cluster_id = recovery_clusters.id) ASC LIMIT 1"
      },
      "name": "ğŸ“¥ ç©ºãã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ¤œç´¢",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒãªã‘ã‚Œã°æ–°è¦ä½œæˆ\nconst clusters = $input.first().json;\nconst config = $node['ğŸ“‹ ç™»éŒ²ãƒ‡ãƒ¼ã‚¿æº–å‚™'].json;\n\nlet clusterId = clusters?.[0]?.id;\n\nif (!clusterId) {\n  // æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆãŒå¿…è¦\n  return [{\n    json: {\n      ...config,\n      need_new_cluster: true,\n      cluster_name: `Cluster-${Date.now()}`\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    ...config,\n    cluster_id: clusterId,\n    need_new_cluster: false\n  }\n}];"
      },
      "name": "ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å‰²ã‚Šå½“ã¦",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true
          },
          "conditions": [
            {
              "leftValue": "={{ $json.need_new_cluster }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "name": "æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¿…è¦ï¼Ÿ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO recovery_clusters (cluster_name, max_accounts, is_active) VALUES ($1, 10, TRUE) RETURNING id",
        "options": {
          "queryParams": "={{ [$json.cluster_name] }}"
        }
      },
      "name": "ğŸ’¾ æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// æ–°è¦ä½œæˆã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IDã‚’å–å¾—\nconst newClusterId = $input.first().json?.[0]?.id;\nconst config = $node['ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å‰²ã‚Šå½“ã¦'].json;\n\nreturn [{\n  json: {\n    ...config,\n    cluster_id: newClusterId\n  }\n}];"
      },
      "name": "ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IDå–å¾—",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "name": "ğŸ”€ ãƒãƒ¼ã‚¸",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO pva_accounts (google_email, google_password_encrypted, recovery_email, phone_number, sim_slot_id, cluster_id, status, trust_score) VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING id, google_email",
        "options": {
          "queryParams": "={{ [$json.account_data.google_email, $json.account_data.google_password_encrypted, $json.account_data.recovery_email, $json.account_data.phone_number, $json.account_data.sim_slot_id, $json.cluster_id, 'active', 100] }}"
        }
      },
      "name": "ğŸ’¾ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT pa.id, pa.google_email, pa.status, pa.trust_score, pa.last_login_at, ap.external_profile_id, ap.provider FROM pva_accounts pa LEFT JOIN antidetect_profiles ap ON pa.antidetect_profile_id = ap.id WHERE pa.status = 'active' AND (pa.last_health_check_at IS NULL OR pa.last_health_check_at < NOW() - INTERVAL '6 hours') LIMIT 50"
      },
      "name": "ğŸ“¥ ãƒã‚§ãƒƒã‚¯å¯¾è±¡å–å¾—",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PVAå¥å…¨æ€§ãƒã‚§ãƒƒã‚¯\n// Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã€YouTube APIå‘¼ã³å‡ºã—å¯å¦ã‚’ç¢ºèª\n// ============================================================================\n\nconst accounts = $input.first().json || [];\n\nif (!Array.isArray(accounts) || accounts.length === 0) {\n  return [{ json: { action: 'health_check', checked_count: 0, message: 'ãƒã‚§ãƒƒã‚¯å¯¾è±¡ãªã—' } }];\n}\n\n// å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒã‚§ãƒƒã‚¯é …ç›®ã‚’ç”Ÿæˆ\nconst healthChecks = accounts.map(account => {\n  return {\n    account_id: account.id,\n    google_email: account.google_email,\n    current_trust_score: account.trust_score,\n    antidetect_profile_id: account.external_profile_id,\n    antidetect_provider: account.provider,\n    checks: [\n      { type: 'google_login', weight: 30 },\n      { type: 'youtube_api', weight: 40 },\n      { type: 'channel_status', weight: 30 }\n    ]\n  };\n});\n\nreturn healthChecks.map(c => ({ json: c }));"
      },
      "name": "ğŸ“‹ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯æº–å‚™",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "batchSize": 5,
        "options": {}
      },
      "name": "ğŸ“¦ ãƒãƒƒãƒå‡¦ç†",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://www.googleapis.com/youtube/v3/channels",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "part",
              "value": "status,snippet"
            },
            {
              "name": "mine",
              "value": "true"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ACCOUNT_TOKEN}}"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "name": "ğŸŒ YouTube APIç¢ºèª",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// å¥å…¨æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—\nconst checkData = $node['ğŸ“‹ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯æº–å‚™'].json;\nconst apiResult = $input.first().json;\n\nlet newTrustScore = checkData.current_trust_score;\nlet newStatus = 'active';\nlet issues = [];\n\n// YouTube APIãŒå¤±æ•—ã—ãŸå ´åˆ\nif (apiResult.error || !apiResult.items) {\n  newTrustScore = Math.max(newTrustScore - 20, 0);\n  issues.push('YouTube API access failed');\n  \n  if (apiResult.error?.code === 403) {\n    newStatus = 'suspended';\n    newTrustScore = Math.max(newTrustScore - 50, 0);\n    issues.push('Account may be suspended');\n  }\n}\n\n// ãƒãƒ£ãƒ³ãƒãƒ«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª\nconst channel = apiResult.items?.[0];\nif (channel) {\n  if (channel.status?.privacyStatus === 'private') {\n    newTrustScore = Math.max(newTrustScore - 10, 0);\n    issues.push('Channel is private');\n  }\n  if (channel.status?.longUploadsStatus !== 'allowed') {\n    issues.push('Long uploads not allowed');\n  }\n}\n\n// ä¿¡é ¼ã‚¹ã‚³ã‚¢ãŒ30ä»¥ä¸‹ãªã‚‰è¦æ³¨æ„\nif (newTrustScore <= 30) {\n  newStatus = 'recovery';\n}\n\n// ã‚¹ã‚³ã‚¢ãŒ0ãªã‚‰å‡çµ\nif (newTrustScore <= 0) {\n  newStatus = 'banned';\n}\n\nreturn [{\n  json: {\n    account_id: checkData.account_id,\n    google_email: checkData.google_email,\n    previous_trust_score: checkData.current_trust_score,\n    new_trust_score: newTrustScore,\n    new_status: newStatus,\n    issues: issues,\n    channel_id: channel?.id,\n    channel_title: channel?.snippet?.title\n  }\n}];"
      },
      "name": "ğŸ“Š ä¿¡é ¼ã‚¹ã‚³ã‚¢è¨ˆç®—",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pva_accounts SET trust_score = $2, status = $3, last_health_check_at = NOW(), youtube_channel_id = COALESCE($4, youtube_channel_id), youtube_channel_title = COALESCE($5, youtube_channel_title) WHERE id = $1",
        "options": {
          "queryParams": "={{ [$json.account_id, $json.new_trust_score, $json.new_status, $json.channel_id, $json.channel_title] }}"
        }
      },
      "name": "ğŸ’¾ å¥å…¨æ€§æ›´æ–°",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT pa.*, rc.cluster_name, rc.recovery_email as cluster_recovery_email FROM pva_accounts pa JOIN recovery_clusters rc ON pa.cluster_id = rc.id WHERE pa.status = 'recovery' OR pa.status = 'suspended' ORDER BY pa.trust_score ASC LIMIT 10"
      },
      "name": "ğŸ“¥ è¦å¾©æ—§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå–å¾—",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¾©æ—§å‡¦ç†\n// åˆ†æ•£å‹ãƒªã‚«ãƒãƒªãƒ„ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ãŸå¾©æ—§ãƒ—ãƒ­ã‚»ã‚¹\n// ============================================================================\n\nconst accounts = $input.first().json || [];\n\nif (!Array.isArray(accounts) || accounts.length === 0) {\n  return [{ json: { action: 'recovery', recovered_count: 0, message: 'å¾©æ—§å¯¾è±¡ãªã—' } }];\n}\n\nconst recoveryTasks = accounts.map(account => {\n  // å¾©æ—§å„ªå…ˆé †ä½ã‚’è¨ˆç®—\n  let priority = 'low';\n  if (account.trust_score <= 10) priority = 'critical';\n  else if (account.trust_score <= 30) priority = 'high';\n  else if (account.trust_score <= 50) priority = 'medium';\n  \n  return {\n    account_id: account.id,\n    google_email: account.google_email,\n    current_status: account.status,\n    trust_score: account.trust_score,\n    cluster_id: account.cluster_id,\n    cluster_name: account.cluster_name,\n    recovery_email: account.recovery_email || account.cluster_recovery_email,\n    phone_number: account.phone_number,\n    priority: priority,\n    recovery_steps: [\n      '1. ã‚¢ãƒ³ãƒãƒ‡ã‚£ãƒ†ã‚¯ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«èµ·å‹•',\n      '2. Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¾©æ—§ãƒšãƒ¼ã‚¸ã¸ã‚¢ã‚¯ã‚»ã‚¹',\n      '3. é›»è©±ç•ªå·ã¾ãŸã¯äºˆå‚™ãƒ¡ãƒ¼ãƒ«ã§èªè¨¼',\n      '4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆï¼ˆå¿…è¦ãªå ´åˆï¼‰',\n      '5. YouTube Studioç¢ºèª',\n      '6. ä¿¡é ¼ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ'\n    ]\n  };\n});\n\nreturn recoveryTasks.map(t => ({ json: t }));"
      },
      "name": "ğŸ“‹ å¾©æ—§ã‚¿ã‚¹ã‚¯ç”Ÿæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO recovery_tasks (account_id, priority, status, recovery_steps) VALUES ($1, $2, 'pending', $3) ON CONFLICT (account_id) WHERE status = 'pending' DO UPDATE SET priority = EXCLUDED.priority, updated_at = NOW() RETURNING id",
        "options": {
          "queryParams": "={{ [$json.account_id, $json.priority, JSON.stringify($json.recovery_steps)] }}"
        }
      },
      "name": "ğŸ’¾ å¾©æ—§ã‚¿ã‚¹ã‚¯ç™»éŒ²",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// ã‚¢ãƒ³ãƒãƒ‡ã‚£ãƒ†ã‚¯ãƒˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰²ã‚Šå½“ã¦\n// PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å°‚ç”¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´ä»˜ã‘\n// ============================================================================\n\nconst config = $input.first().json;\nconst accountId = config.account_id;\nconst profileId = config.profile_id; // antidetect_profiles.id\n\nif (!accountId || !profileId) {\n  return [{ json: { success: false, error: 'account_idã¨profile_idã¯å¿…é ˆã§ã™' } }];\n}\n\nreturn [{\n  json: {\n    account_id: accountId,\n    profile_id: profileId\n  }\n}];"
      },
      "name": "ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰²ã‚Šå½“ã¦æº–å‚™",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE pva_accounts SET antidetect_profile_id = $2 WHERE id = $1 RETURNING id, google_email, antidetect_profile_id",
        "options": {
          "queryParams": "={{ [$json.account_id, $json.profile_id] }}"
        }
      },
      "name": "ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç´ä»˜ã‘",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE antidetect_profiles SET assigned_account_id = $1 WHERE id = $2",
        "options": {
          "queryParams": "={{ [$json[0]?.id, $node['ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰²ã‚Šå½“ã¦æº–å‚™'].json.profile_id] }}"
        }
      },
      "name": "ğŸ’¾ é€†ç´ä»˜ã‘æ›´æ–°",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// æœ€çµ‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ\nconst action = $node['ğŸ”§ åˆæœŸåŒ–'].json.action;\n\nlet result = { success: true, action: action };\n\nswitch (action) {\n  case 'list':\n    const accounts = $node['ğŸ“¥ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§å–å¾—'].json;\n    result.accounts = accounts;\n    result.count = Array.isArray(accounts) ? accounts.length : 0;\n    break;\n    \n  case 'register':\n    result.message = 'PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²å®Œäº†';\n    result.account = $node['ğŸ’¾ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²'].json?.[0];\n    break;\n    \n  case 'health_check':\n    result.message = 'å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯å®Œäº†';\n    result.checked_count = $items().length;\n    break;\n    \n  case 'recovery':\n    result.message = 'å¾©æ—§ã‚¿ã‚¹ã‚¯ç”Ÿæˆå®Œäº†';\n    result.tasks = $items().map(i => i.json);\n    break;\n    \n  case 'assign_profile':\n    result.message = 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰²ã‚Šå½“ã¦å®Œäº†';\n    result.account = $node['ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç´ä»˜ã‘'].json?.[0];\n    break;\n}\n\nreturn [{ json: result }];"
      },
      "name": "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[PYTHON_MIGRATION_CANDIDATE]"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {
          "responseCode": 200
        }
      },
      "name": "âœ… æˆåŠŸå¿œç­”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "jsCode": "// ğŸ” HMAC SHA256 ç½²åæ¤œè¨¼ (Empire OS v6)\nconst crypto = require('crypto');\n\nconst signature = $request.headers['x-n3-signature'] || $request.headers['X-N3-Signature'];\nconst timestamp = $request.headers['x-n3-timestamp'] || $request.headers['X-N3-Timestamp'];\nconst secret = $env.N8N_HMAC_SECRET;\n\nif (!secret) {\n  throw new Error('ğŸš« N8N_HMAC_SECRET ç’°å¢ƒå¤‰æ•°ãŒæœªè¨­å®šã§ã™');\n}\n\nif (!signature || !timestamp) {\n  throw new Error('ğŸš« ç½²åã¾ãŸã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæ¬ è½ã—ã¦ã„ã¾ã™');\n}\n\n// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ (5åˆ†)\nconst now = Date.now();\nconst tsAge = now - parseInt(timestamp);\nif (tsAge > 300000 || tsAge < -30000) {\n  throw new Error('ğŸš« ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæœŸé™åˆ‡ã‚Œã¾ãŸã¯ä¸æ­£ã§ã™');\n}\n\n// HMACæ¤œè¨¼\nconst bodyString = JSON.stringify($json);\nconst computedHmac = crypto\n  .createHmac('sha256', secret)\n  .update(timestamp + '.' + bodyString)\n  .digest('hex');\n\nif (signature !== computedHmac) {\n  throw new Error('ğŸš« HMACç½²åæ¤œè¨¼å¤±æ•—: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ');\n}\n\n// æ¤œè¨¼æˆåŠŸ - å…ƒãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è¿”ã™\nreturn [{ json: $json }];"
      },
      "name": "ğŸ” HMACç½²åæ¤œè¨¼",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[EMPIRE_OS_V6] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åˆ¶æŒ¿å…¥"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{$env.SUPABASE_URL}}/rest/v1/execution_logs",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{$env.SUPABASE_ANON_KEY}}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{$env.SUPABASE_SERVICE_ROLE_KEY}}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"workflow_id\": \"{{$workflow.id}}\",\n  \"workflow_name\": \"{{$workflow.name}}\",\n  \"status\": \"success\",\n  \"execution_time_ms\": {{Date.now() - $execution.startedAt.getTime()}},\n  \"error_message\": null,\n  \"executed_at\": \"{{new Date().toISOString()}}\",\n  \"node_count\": {{$workflow.nodes.length}},\n  \"metadata\": {}\n}"
      },
      "name": "ğŸ“Š å®Ÿè¡Œãƒ­ã‚°é€ä¿¡ (æˆåŠŸ)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true,
      "notes": "[EMPIRE_OS_V6] ä¸­å¤®ç›£è¦–ãƒ‘ãƒ«ã‚¹"
    }
  ],
  "connections": {
    "Webhook: pva-manage": {
      "main": [
        [
          {
            "node": "ğŸ” HMACç½²åæ¤œè¨¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â° 6æ™‚é–“ã”ã¨å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [
          {
            "node": "ğŸ”§ åˆæœŸåŒ–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”§ åˆæœŸåŒ–": {
      "main": [
        [
          {
            "node": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†å²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†å²": {
      "main": [
        [
          {
            "node": "ğŸ“¥ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§å–å¾—",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“‹ ç™»éŒ²ãƒ‡ãƒ¼ã‚¿æº–å‚™",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“¥ ãƒã‚§ãƒƒã‚¯å¯¾è±¡å–å¾—",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“¥ è¦å¾©æ—§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå–å¾—",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰²ã‚Šå½“ã¦æº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§å–å¾—": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ ç™»éŒ²ãƒ‡ãƒ¼ã‚¿æº–å‚™": {
      "main": [
        [
          {
            "node": "ğŸ“¥ ç©ºãã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ¤œç´¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ ç©ºãã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ¤œç´¢": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å‰²ã‚Šå½“ã¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å‰²ã‚Šå½“ã¦": {
      "main": [
        [
          {
            "node": "æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¿…è¦ï¼Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¿…è¦ï¼Ÿ": {
      "main": [
        [
          {
            "node": "ğŸ’¾ æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ”€ ãƒãƒ¼ã‚¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ æ–°è¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆ": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IDå–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IDå–å¾—": {
      "main": [
        [
          {
            "node": "ğŸ”€ ãƒãƒ¼ã‚¸",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”€ ãƒãƒ¼ã‚¸": {
      "main": [
        [
          {
            "node": "ğŸ’¾ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ PVAã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ ãƒã‚§ãƒƒã‚¯å¯¾è±¡å–å¾—": {
      "main": [
        [
          {
            "node": "ğŸ“‹ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯æº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯æº–å‚™": {
      "main": [
        [
          {
            "node": "ğŸ“¦ ãƒãƒƒãƒå‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ ãƒãƒƒãƒå‡¦ç†": {
      "main": [
        [
          {
            "node": "ğŸŒ YouTube APIç¢ºèª",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ YouTube APIç¢ºèª": {
      "main": [
        [
          {
            "node": "ğŸ“Š ä¿¡é ¼ã‚¹ã‚³ã‚¢è¨ˆç®—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š ä¿¡é ¼ã‚¹ã‚³ã‚¢è¨ˆç®—": {
      "main": [
        [
          {
            "node": "ğŸ’¾ å¥å…¨æ€§æ›´æ–°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ å¥å…¨æ€§æ›´æ–°": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ è¦å¾©æ—§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå–å¾—": {
      "main": [
        [
          {
            "node": "ğŸ“‹ å¾©æ—§ã‚¿ã‚¹ã‚¯ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ å¾©æ—§ã‚¿ã‚¹ã‚¯ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "ğŸ’¾ å¾©æ—§ã‚¿ã‚¹ã‚¯ç™»éŒ²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ å¾©æ—§ã‚¿ã‚¹ã‚¯ç™»éŒ²": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰²ã‚Šå½“ã¦æº–å‚™": {
      "main": [
        [
          {
            "node": "ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç´ä»˜ã‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç´ä»˜ã‘": {
      "main": [
        [
          {
            "node": "ğŸ’¾ é€†ç´ä»˜ã‘æ›´æ–°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ é€†ç´ä»˜ã‘æ›´æ–°": {
      "main": [
        [
          {
            "node": "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "âœ… æˆåŠŸå¿œç­”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” HMACç½²åæ¤œè¨¼": {
      "main": [
        [
          {
            "node": "ğŸ”§ åˆæœŸåŒ–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionTimeout": 600,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  },
  "tags": [
    {
      "name": "N3-Defense",
      "color": "#e74c3c"
    },
    {
      "name": "V5-PRODUCTION",
      "color": "#00ff00"
    },
    {
      "name": "PVA",
      "color": "#3498db"
    },
    {
      "name": "Phase-14",
      "color": "#f39c12"
    },
    {
      "name": "Empire-OS-V6",
      "color": "#ff4500"
    }
  ],
  "active": false
}