# Phase G: æœ¬ç•ªèµ·å‹•ãƒ•ã‚§ãƒ¼ã‚ºè¨­è¨ˆæ›¸

## ğŸ¯ ç›®çš„

N3 Empire OS ã‚’ã€Œå®‰å…¨ã«æœ¬ç•ªèµ·å‹•ã§ãã‚‹æ§‹æˆã€ã«ã™ã‚‹
- ãƒœã‚¿ãƒ³1ã¤ã§å®‰å…¨ã«æ­¢ã‚ã‚‰ã‚Œã‚‹
- ãƒœã‚¿ãƒ³1ã¤ã§å†èµ·å‹•ã§ãã‚‹
- è‡ªå‹•åŒ–ãŒå®‰å…¨ã«èµ°ã‚‹

---

## â‘  Control Center é‹ç”¨ãƒ¢ãƒ¼ãƒ‰è¨­è¨ˆ

### é‹ç”¨ãƒ¢ãƒ¼ãƒ‰å®šç¾©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     OPERATION MODES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mode   â”‚ Automationâ”‚ Dispatch   â”‚ ç”¨é€”                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DEV     â”‚ æ‰‹å‹•ã®ã¿  â”‚ Local/Mock â”‚ é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°          â”‚
â”‚ STAGING â”‚ åˆ¶é™ä»˜ã  â”‚ n8n (test) â”‚ ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼            â”‚
â”‚ PROD    â”‚ å…¨è‡ªå‹•    â”‚ n8n (live) â”‚ æœ¬ç•ªé‹ç”¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Ÿè¡Œåˆ¶å¾¡ãƒ«ãƒ¼ãƒ«

| Mode    | Scheduler | Pipeline | Rate Limit | Kill Switch |
|---------|-----------|----------|------------|-------------|
| DEV     | OFF       | æ‰‹å‹•     | ç·©å’Œ       | å¸¸æ™‚æœ‰åŠ¹    |
| STAGING | æ‰‹å‹•èµ·å‹•  | æ‰‹å‹•     | æœ¬ç•ªåŒç­‰   | å¸¸æ™‚æœ‰åŠ¹    |
| PROD    | è‡ªå‹•      | è‡ªå‹•     | å³æ ¼       | å¸¸æ™‚æœ‰åŠ¹    |

### ãƒ¢ãƒ¼ãƒ‰é·ç§»æ¡ä»¶

```
DEV â†’ STAGING: 
  - å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼
  - Adminæ‰¿èª

STAGING â†’ PROD:
  - Pre-flight Check åˆæ ¼
  - Commercial Score â‰¥ 90
  - Adminæ‰¿èª + ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

PROD â†’ STAGING:
  - Kill Switch ã¾ãŸã¯ Adminæ“ä½œ

Any â†’ DEV:
  - Adminæ¨©é™ã§å³æ™‚å¯èƒ½
```

---

## â‘¡ èµ·å‹•å‰ãƒã‚§ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆPre-flight Checkï¼‰

### ãƒã‚§ãƒƒã‚¯é …ç›®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRE-FLIGHT CHECK                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 1. Secrets  â”‚ â†’ â”‚ 2. API      â”‚ â†’ â”‚ 3. Database â”‚       â”‚
â”‚  â”‚    Check    â”‚   â”‚    Health   â”‚   â”‚   Integrity â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                â”‚                 â”‚                â”‚
â”‚         â–¼                â–¼                 â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 4. n8n     â”‚ â†’ â”‚ 5. Dispatch â”‚ â†’ â”‚ 6. Final    â”‚       â”‚
â”‚  â”‚    Status   â”‚   â”‚    Ready    â”‚   â”‚   Approval  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. Secrets å­˜åœ¨æ¤œè¨¼

```typescript
const REQUIRED_SECRETS = {
  critical: [
    'SUPABASE_URL',
    'SUPABASE_SERVICE_ROLE_KEY',
    'EBAY_CLIENT_ID',
    'EBAY_CLIENT_SECRET',
  ],
  optional: [
    'CHATWORK_API_KEY',
    'OPENAI_API_KEY',
  ]
};
```

### 2. API Health Check

```typescript
const API_HEALTH_CHECKS = [
  { name: 'Dispatch API', endpoint: '/api/dispatch', expect: 200 },
  { name: 'Automation API', endpoint: '/api/automation/settings', expect: 200 },
  { name: 'Pipeline API', endpoint: '/api/automation/pipeline', expect: 200 },
];
```

### 3. Database Integrity

```typescript
const DB_INTEGRITY_CHECKS = [
  { table: 'products_master', minRows: 0, required: true },
  { table: 'n3_automation_settings', minRows: 1, required: true },
  { table: 'n3_system_flags', minRows: 1, required: true },
  { table: 'n3_user_roles', minRows: 1, required: true },
];
```

### 4. n8n Status Check

```typescript
const N8N_CHECKS = [
  { name: 'n8n Server', endpoint: '/healthz', expect: 200 },
  { name: 'Master Scheduler', workflow: 'n3-master-scheduler', active: true },
];
```

---

## â‘¢ Kill Switch UI è¨­è¨ˆ

### Kill Switch çŠ¶æ…‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     KILL SWITCH                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸŸ¢ SYSTEM RUNNING                                   â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  Scheduler: âœ… Active    Pipeline: âœ… Active        â”‚   â”‚
â”‚  â”‚  Dispatch:  âœ… Ready     Rate Limit: âœ… Normal      â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ”´ EMERGENCY    â”‚  â”‚ â¸ï¸ PAUSE       â”‚           â”‚   â”‚
â”‚  â”‚  â”‚    STOP         â”‚  â”‚    SCHEDULER    â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Kill Switch ãƒ¬ãƒ™ãƒ«

| Level | åå‰ | å½±éŸ¿ç¯„å›² | å¾©æ—§æ–¹æ³• |
|-------|------|----------|----------|
| 0 | Normal | ãªã— | - |
| 1 | Scheduler Pause | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼åœæ­¢ | Resume ãƒœã‚¿ãƒ³ |
| 2 | Pipeline Pause | ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åœæ­¢ | Resume ãƒœã‚¿ãƒ³ |
| 3 | Dispatch Halt | å…¨Dispatchåœæ­¢ | Adminè§£é™¤ |
| 4 | Emergency Stop | å…¨ã‚·ã‚¹ãƒ†ãƒ åœæ­¢ | Adminè§£é™¤ + ç¢ºèª |

### æ‰‹å‹•ä»‹å…¥çŠ¶æ…‹

```typescript
interface ManualInterventionState {
  active: boolean;
  reason: string;
  activatedAt: Date;
  activatedBy: string;
  allowedActions: string[]; // è¨±å¯ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  blockedActions: string[]; // ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³
}
```

---

## â‘£ èµ·å‹•ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STARTUP SEQUENCE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚   User Click    Pre-flight     Confirm      Gradual          â”‚
â”‚   "START"   â†’   Check      â†’   Dialog   â†’   Warmup           â”‚
â”‚                                                               â”‚
â”‚       â”‚             â”‚             â”‚             â”‚             â”‚
â”‚       â”‚             â”‚             â”‚             â–¼             â”‚
â”‚       â”‚             â”‚             â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ Step 1:     â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ Scheduler   â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ (30s wait)  â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â”‚             â”‚             â”‚             â”‚             â”‚
â”‚       â”‚             â”‚             â”‚             â–¼             â”‚
â”‚       â”‚             â”‚             â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ Step 2:     â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ Pipeline    â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ (30s wait)  â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â”‚             â”‚             â”‚             â”‚             â”‚
â”‚       â”‚             â”‚             â”‚             â–¼             â”‚
â”‚       â”‚             â”‚             â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ Step 3:     â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â”‚ Full Auto   â”‚     â”‚
â”‚       â”‚             â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èµ·å‹•æ¡ä»¶

```typescript
interface StartupConditions {
  // å¿…é ˆæ¡ä»¶
  preflightPassed: boolean;
  adminApproved: boolean;
  killSwitchOff: boolean;
  
  // æ¨å¥¨æ¡ä»¶
  commercialScore: number; // â‰¥ 90 æ¨å¥¨
  quarantinedTools: number; // = 0 æ¨å¥¨
  
  // è­¦å‘Šæ¡ä»¶
  activeJobs: number; // < 10 æ¨å¥¨
  recentErrors: number; // < 5 æ¨å¥¨
}
```

### è¨±å¯æ¡ä»¶

| æ¡ä»¶ | DEV | STAGING | PROD |
|------|-----|---------|------|
| Pre-flight Pass | - | âœ… | âœ… |
| Admin Approval | - | âœ… | âœ… |
| Commercial Score â‰¥ 90 | - | - | âœ… |
| Quarantined = 0 | - | - | âœ… |
| Confirm Dialog | - | âœ… | âœ… |

### UI è¡¨ç¤ºçŠ¶æ…‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STARTUP PANEL                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Current Mode: [ DEV â–¼ ]                                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Pre-flight Status                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚ âœ… â”‚ â”‚ âœ… â”‚ â”‚ âœ… â”‚ â”‚ âœ… â”‚ â”‚ âœ… â”‚ â”‚ â³ â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚  Secrets API    DB     n8n   Dispatch Approval     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [â–¶ï¸ START PRODUCTION]                               â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  âš ï¸ This will enable full automation               â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â‘¤ å®‰å…¨ã‚¬ãƒ¼ãƒ‰è¨­è¨ˆ

### åˆå›èµ·å‹•åˆ¶é™

```typescript
const FIRST_RUN_LIMITS = {
  // æœ€åˆã®1æ™‚é–“ã¯åˆ¶é™ä»˜ã
  maxConcurrentJobs: 2,
  maxListingsPerHour: 10,
  allowedTools: ['inventory-sync', 'research-agent'],
  
  // å®‰å®šç¢ºèªå¾Œã«è§£é™¤
  stableThreshold: {
    successRate: 95,
    minExecutions: 50,
    duration: '1h',
  },
};
```

### Rate Limit è¡çªé˜²æ­¢

```typescript
const RATE_LIMIT_GUARDS = {
  // APIæ¯ã®åˆ¶é™
  ebay: { requestsPerMinute: 30, burst: 50 },
  amazon: { requestsPerMinute: 20, burst: 30 },
  
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆ¶é™
  global: {
    maxConcurrent: 10,
    cooldownOnError: 30000, // 30ç§’
  },
  
  // è¡çªæ¤œçŸ¥
  collision: {
    sameToolInterval: 5000, // åŒã˜ãƒ„ãƒ¼ãƒ«é–“éš”
    sameCategoryInterval: 2000, // åŒã‚«ãƒ†ã‚´ãƒªé–“éš”
  },
};
```

### ãƒ‡ãƒ¼ã‚¿æ±šæŸ“é˜²æ­¢

```typescript
const DATA_PROTECTION = {
  // æ›¸ãè¾¼ã¿å‰æ¤œè¨¼
  validation: {
    products: ['sku', 'title', 'price'],
    inventory: ['product_id', 'quantity'],
    listings: ['product_id', 'marketplace'],
  },
  
  // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
  rollback: {
    enabled: true,
    maxAffectedRows: 100,
    requireApproval: true,
  },
  
  // ç›£æŸ»ãƒ­ã‚°
  audit: {
    logAllWrites: true,
    retentionDays: 30,
  },
};
```

---

## Flow Diagram

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Control Center    â”‚
                    â”‚   (Mode Selector)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚               â”‚               â”‚
              â–¼               â–¼               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   DEV   â”‚     â”‚ STAGING â”‚     â”‚  PROD   â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚               â”‚               â”‚
             â”‚               â”‚               â–¼
             â”‚               â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚               â”‚        â”‚  Pre-flight â”‚
             â”‚               â”‚        â”‚    Check    â”‚
             â”‚               â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚               â”‚               â”‚
             â”‚               â”‚               â–¼
             â”‚               â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚               â”‚        â”‚   Confirm   â”‚
             â”‚               â”‚        â”‚   Dialog    â”‚
             â”‚               â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚               â”‚               â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Startup Engine â”‚
                    â”‚  (Gradual)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚Scheduler â”‚  â”‚ Pipeline â”‚  â”‚ Full     â”‚
        â”‚ (Step 1) â”‚â†’ â”‚ (Step 2) â”‚â†’ â”‚ Auto     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Running...    â”‚
                    â”‚                 â”‚
                    â”‚  [Kill Switch]  â”‚
                    â”‚  [Emergency]    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Ÿè£…æ§‹æˆ

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

```
lib/
â”œâ”€â”€ startup/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ preflight-check.ts    # Pre-flight Check
â”‚   â”œâ”€â”€ startup-engine.ts     # èµ·å‹•ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ operation-mode.ts     # é‹ç”¨ãƒ¢ãƒ¼ãƒ‰ç®¡ç†
â”‚   â””â”€â”€ safety-guards.ts      # å®‰å…¨ã‚¬ãƒ¼ãƒ‰

app/api/
â”œâ”€â”€ system/
â”‚   â”œâ”€â”€ startup/
â”‚   â”‚   â””â”€â”€ route.ts          # èµ·å‹•API
â”‚   â”œâ”€â”€ preflight/
â”‚   â”‚   â””â”€â”€ route.ts          # Pre-flight API
â”‚   â””â”€â”€ mode/
â”‚       â””â”€â”€ route.ts          # ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´API

app/tools/control-n3/components/panels/
â”œâ”€â”€ startup-panel.tsx         # èµ·å‹•ãƒ‘ãƒãƒ«
â””â”€â”€ kill-switch-panel.tsx     # Kill Switch ãƒ‘ãƒãƒ«
```

### APIæ§‹æˆ

| Endpoint | Method | æ©Ÿèƒ½ |
|----------|--------|------|
| `/api/system/preflight` | GET | Pre-flight Check å®Ÿè¡Œ |
| `/api/system/startup` | POST | ã‚·ã‚¹ãƒ†ãƒ èµ·å‹• |
| `/api/system/startup` | DELETE | ã‚·ã‚¹ãƒ†ãƒ åœæ­¢ |
| `/api/system/mode` | GET | ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰å–å¾— |
| `/api/system/mode` | POST | ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´ |
| `/api/system/kill-switch` | GET | Kill Switch çŠ¶æ…‹ |
| `/api/system/kill-switch` | POST | Kill Switch æ“ä½œ |

---

## UIé…ç½®æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  N3 Empire OS - Control Center                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Mode: [PROD â–¼]  â”‚ Status: ğŸŸ¢ Running â”‚ Score: 95/100     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Monitor â”‚ Health  â”‚Automate â”‚ Tools   â”‚ Startup â”‚ Kill   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚                    [Selected Tab Content]                 â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”´ EMERGENCY STOP â”‚ â¸ï¸ PAUSE ALL â”‚ ğŸ“Š Quick Stats        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœ€çµ‚ã‚´ãƒ¼ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   âœ… ãƒœã‚¿ãƒ³1ã¤ã§å®‰å…¨ã«æ­¢ã‚ã‚‰ã‚Œã‚‹                                â”‚
â”‚      â†’ Emergency Stop / Kill Switch UI                         â”‚
â”‚                                                                 â”‚
â”‚   âœ… ãƒœã‚¿ãƒ³1ã¤ã§å†èµ·å‹•ã§ãã‚‹                                    â”‚
â”‚      â†’ Pre-flight Check â†’ Gradual Warmup â†’ Full Auto          â”‚
â”‚                                                                 â”‚
â”‚   âœ… è‡ªå‹•åŒ–ãŒå®‰å…¨ã«èµ°ã‚‹                                         â”‚
â”‚      â†’ Safety Guards + Rate Limit + Data Protection           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
