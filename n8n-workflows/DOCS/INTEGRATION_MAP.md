# N3 Empire OS çµ±åˆãƒãƒƒãƒ—

## ğŸ¯ å…¨ä½“åƒï¼šã“ã‚ŒãŒç›®æŒ‡ã™ã‚·ã‚¹ãƒ†ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        N3 Empire OS                                  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Workspace UIï¼ˆ5ã‚¿ãƒ–çµ±åˆç”»é¢ï¼‰                                â”‚   â”‚
â”‚  â”‚  /tools/workspace                                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  [Catalog] [Sourcing] [Execution] [Finance] [Control]       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚   â†“ ãƒœã‚¿ãƒ³æŠ¼ä¸‹                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Dispatch APIï¼ˆçµ±åˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ï¼‰                             â”‚   â”‚
â”‚  â”‚  /api/dispatch                                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â€¢ èªè¨¼ãƒã‚§ãƒƒã‚¯ (Auth-Gate)                                  â”‚   â”‚
â”‚  â”‚  â€¢ ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯ (Billing-Guard)                            â”‚   â”‚
â”‚  â”‚  â€¢ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ (Rate-Limiter)                                â”‚   â”‚
â”‚  â”‚  â€¢ ã‚¸ãƒ§ãƒ–ç™»éŒ² (Job-Guard)                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  n8n Webhookï¼ˆè‡ªå‹•åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰                               â”‚   â”‚
â”‚  â”‚  http://160.16.120.186:5678/webhook/...                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â€¢ 142å€‹ã®JSON Workflow                                     â”‚   â”‚
â”‚  â”‚  â€¢ HMACç½²åæ¤œè¨¼                                             â”‚   â”‚
â”‚  â”‚  â€¢ å®Ÿè¡Œãƒ­ã‚°è¨˜éŒ²                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Supabaseï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â€¢ products_masterï¼ˆå•†å“ï¼‰                                  â”‚   â”‚
â”‚  â”‚  â€¢ inventory_masterï¼ˆåœ¨åº«ï¼‰                                 â”‚   â”‚
â”‚  â”‚  â€¢ dispatch_jobsï¼ˆã‚¸ãƒ§ãƒ–ï¼‰                                  â”‚   â”‚
â”‚  â”‚  â€¢ organizationsï¼ˆçµ„ç¹”ï¼‰                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š 5ã‚¿ãƒ–ã¨n8n JSONã®å¯¾å¿œé–¢ä¿‚

### Tab 1: Catalogï¼ˆãƒ‡ãƒ¼ã‚¿ç·¨é›†ï¼‰= editing-n3

```
ã€UIã€‘/tools/editing-n3
  â”‚
  â”œâ”€â”€ å•†å“ã‚¿ãƒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘å•†å“ç³»
  â”‚   â”œâ”€â”€ å•†å“ä¸€è¦§
  â”‚   â”œâ”€â”€ å•†å“ç·¨é›†
  â”‚   â””â”€â”€ ç¿»è¨³ãƒ»AIå‡¦ç†
  â”‚
  â”œâ”€â”€ åœ¨åº«ã‚¿ãƒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘åœ¨åº«ç³»ï¼ˆ16å€‹ï¼‰
  â”‚   â”œâ”€â”€ ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†    â†’  inventory-sync-master.json
  â”‚   â”œâ”€â”€ æœ‰åœ¨åº«ç®¡ç†      â†’  inventory-stock-update.json
  â”‚   â””â”€â”€ åœ¨åº«åŒæœŸ        â†’  inventory-multi-sync.json
  â”‚
  â””â”€â”€ å‡ºå“ã‚¿ãƒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘å‡ºå“ç³»ï¼ˆ23å€‹ï¼‰
      â”œâ”€â”€ eBayå‡ºå“        â†’  listing-ebay-single.json
      â”œâ”€â”€ Amazonå‡ºå“      â†’  listing-amazon-single.json
      â”œâ”€â”€ äºˆç´„å‡ºå“        â†’  listing-schedule-batch.json
      â””â”€â”€ å¤šåº—èˆ—åŒæ™‚å‡ºå“   â†’  listing-multi-platform.json
```

### Tab 2: Sourcingï¼ˆãƒªã‚µãƒ¼ãƒï¼‰= research-n3

```
ã€UIã€‘/tools/research-n3
  â”‚
  â”œâ”€â”€ eBayãƒªã‚µãƒ¼ãƒ â”€â”€â”€â”€â†’ ã€JSONã€‘ãƒªã‚µãƒ¼ãƒç³»ï¼ˆ18å€‹ï¼‰
  â”‚   â”œâ”€â”€ å•†å“æ¤œç´¢      â†’  research-ebay-search.json
  â”‚   â””â”€â”€ SMåˆ†æ        â†’  research-seller-mirror.json
  â”‚
  â”œâ”€â”€ Amazonãƒªã‚µãƒ¼ãƒ â”€â”€â†’ 
  â”‚   â”œâ”€â”€ ASINæ¤œç´¢      â†’  research-amazon-asin.json
  â”‚   â””â”€â”€ Keepaåˆ†æ     â†’  research-keepa-analyze.json
  â”‚
  â””â”€â”€ ä»•å…¥ã‚Œåˆ¤æ–­ â”€â”€â”€â”€â”€â†’
      â””â”€â”€ åˆ©ç›Šè¨ˆç®—      â†’  research-profit-calculate.json
```

### Tab 3: Executionï¼ˆã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰= operations-n3

```
ã€UIã€‘/tools/operations-n3
  â”‚
  â”œâ”€â”€ å—æ³¨ç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘å—æ³¨ç³»
  â”‚   â”œâ”€â”€ æ³¨æ–‡å–å¾—      â†’  order-fetch-new.json
  â”‚   â””â”€â”€ æ³¨æ–‡å‡¦ç†      â†’  order-process.json
  â”‚
  â”œâ”€â”€ é…é€ç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘é…é€ç³»
  â”‚   â”œâ”€â”€ ãƒ©ãƒ™ãƒ«å°åˆ·    â†’  shipping-label-print.json
  â”‚   â””â”€â”€ è¿½è·¡æ›´æ–°      â†’  shipping-tracking-update.json
  â”‚
  â””â”€â”€ CSå¯¾å¿œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘CSç³»
      â”œâ”€â”€ å•ã„åˆã‚ã›    â†’  inquiry-fetch.json
      â””â”€â”€ è‡ªå‹•è¿”ä¿¡      â†’  inquiry-auto-reply.json
```

### Tab 4: Financeï¼ˆãƒ•ã‚¡ã‚¤ãƒŠãƒ³ã‚¹ï¼‰= finance-n3

```
ã€UIã€‘/tools/finance-n3
  â”‚
  â”œâ”€â”€ å£²ä¸Šåˆ†æ â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘åˆ†æç³»
  â”‚   â”œâ”€â”€ æ—¥æ¬¡é›†è¨ˆ      â†’  analytics-daily-summary.json
  â”‚   â””â”€â”€ åˆ©ç›Šãƒ¬ãƒãƒ¼ãƒˆ   â†’  analytics-profit-report.json
  â”‚
  â””â”€â”€ ä¼šè¨ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€JSONã€‘ä¼šè¨ˆç³»
      â”œâ”€â”€ ä»•è¨³ç”Ÿæˆ      â†’  bookkeeping-journal.json
      â””â”€â”€ çµŒè²»è¨˜éŒ²      â†’  bookkeeping-expense.json
```

### Tab 5: Controlï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼‰= control-n3

```
ã€UIã€‘/tools/control-n3
  â”‚
  â”œâ”€â”€ ã‚¸ãƒ§ãƒ–ç›£è¦– â”€â”€â”€â”€â”€â”€â†’ ã€APIã€‘/api/dispatch/jobs
  â”‚   â”œâ”€â”€ å®Ÿè¡Œä¸­        â†’  ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
  â”‚   â”œâ”€â”€ å¤±æ•—          â†’  ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
  â”‚   â””â”€â”€ å®Œäº†          â†’  å±¥æ­´è¡¨ç¤º
  â”‚
  â”œâ”€â”€ ä½¿ç”¨é‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€APIã€‘/api/tenant/usage âš ï¸ æœªçµ±åˆ
  â”‚   â”œâ”€â”€ æœˆé–“å®Ÿè¡Œæ•°
  â”‚   â”œâ”€â”€ åŒæ™‚å®Ÿè¡Œæ•°
  â”‚   â””â”€â”€ APIå‘¼ã³å‡ºã—
  â”‚
  â”œâ”€â”€ HitLæ‰¿èª â”€â”€â”€â”€â”€â”€â”€â”€â†’ ã€APIã€‘/api/hitl/pending âš ï¸ æœªçµ±åˆ
  â”‚   â””â”€â”€ æ‰¿èªå¾…ã¡ã‚­ãƒ¥ãƒ¼
  â”‚
  â””â”€â”€ ã‚­ãƒ«ã‚¹ã‚¤ãƒƒãƒ â”€â”€â”€â†’ ã€APIã€‘/api/dispatch/kill-switch
      â””â”€â”€ ç·Šæ€¥åœæ­¢
```

---

## âœ… ç¾åœ¨å‹•ã„ã¦ã„ã‚‹ã‚‚ã®

### UIï¼ˆè¡¨ç¤ºã§ãã‚‹ï¼‰
| ãƒ‘ã‚¹ | èª¬æ˜ | çŠ¶æ…‹ |
|------|------|------|
| `/tools/workspace` | 5ã‚¿ãƒ–çµ±åˆç”»é¢ | âœ… å‹•ä½œä¸­ |
| `/tools/editing-n3` | ãƒ‡ãƒ¼ã‚¿ç·¨é›†ï¼ˆå•†å“ãƒ»åœ¨åº«ãƒ»å‡ºå“ï¼‰ | âœ… å‹•ä½œä¸­ |
| `/tools/research-n3` | ãƒªã‚µãƒ¼ãƒ | âœ… å‹•ä½œä¸­ |
| `/tools/operations-n3` | ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… å‹•ä½œä¸­ |
| `/tools/finance-n3` | ãƒ•ã‚¡ã‚¤ãƒŠãƒ³ã‚¹ | âœ… å‹•ä½œä¸­ |
| `/tools/control-n3` | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆã‚¸ãƒ§ãƒ–ç›£è¦–ï¼‰ | âœ… å‹•ä½œä¸­ |
| `/onboarding` | æ–°è¦ç™»éŒ²ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ | âœ… å‹•ä½œä¸­ |

### APIï¼ˆå‘¼ã³å‡ºã›ã‚‹ï¼‰
| ãƒ‘ã‚¹ | èª¬æ˜ | çŠ¶æ…‹ |
|------|------|------|
| `/api/dispatch` | ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ | âœ… ä½œæˆæ¸ˆ |
| `/api/dispatch/jobs` | ã‚¸ãƒ§ãƒ–ä¸€è¦§ | âœ… ä½œæˆæ¸ˆ |
| `/api/dispatch/status` | ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ | âœ… ä½œæˆæ¸ˆ |
| `/api/dispatch/kill-switch` | ç·Šæ€¥åœæ­¢ | âœ… ä½œæˆæ¸ˆ |
| `/api/tenant/organizations` | çµ„ç¹”ç®¡ç† | âœ… ä½œæˆæ¸ˆ |
| `/api/tenant/usage` | ä½¿ç”¨é‡ | âœ… ä½œæˆæ¸ˆ |
| `/api/hitl/*` | HitLæ‰¿èª | âœ… ä½œæˆæ¸ˆ |

### Guardsï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰
| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | çŠ¶æ…‹ |
|---------|------|------|
| `lib/guards/rate-limiter.ts` | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | âœ… ä½œæˆæ¸ˆ |
| `lib/guards/job-guard.ts` | ã‚¸ãƒ§ãƒ–ç®¡ç† | âœ… ä½œæˆæ¸ˆ |
| `lib/guards/billing-guard.ts` | èª²é‡‘åˆ¶å¾¡ | âœ… ä½œæˆæ¸ˆ |
| `lib/guards/rbac.ts` | æ¨©é™ç®¡ç† | âœ… ä½œæˆæ¸ˆ |
| `lib/guards/webhook-firewall.ts` | Webhookä¿è­· | âœ… ä½œæˆæ¸ˆ |

---

## âŒ æœªçµ±åˆãƒ»è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚‚ã®

### 1. OrganizationSwitcherï¼ˆçµ„ç¹”åˆ‡æ›¿ï¼‰

**ç¾çŠ¶**: ä½œæˆæ¸ˆã¿ã ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„

```
ã€ãƒ•ã‚¡ã‚¤ãƒ«ã€‘components/tenant/OrganizationSwitcher.tsx

ã€çµ±åˆå…ˆã€‘ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå³ä¸Šï¼‰

ã€è¡¨ç¤ºå†…å®¹ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç¾åœ¨ã®çµ„ç¹”å â–¼]      â”‚
â”‚                      â”‚
â”‚ â”œâ”€ çµ„ç¹”A âœ“           â”‚
â”‚ â”œâ”€ çµ„ç¹”B             â”‚
â”‚ â””â”€ æ–°è¦ä½œæˆ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. UsageDashboardï¼ˆä½¿ç”¨é‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰

**ç¾çŠ¶**: ä½œæˆæ¸ˆã¿ã ãŒcontrol-n3ã«è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„

```
ã€ãƒ•ã‚¡ã‚¤ãƒ«ã€‘components/tenant/UsageDashboard.tsx

ã€çµ±åˆå…ˆã€‘control-n3ã®æ–°ã‚¿ãƒ–ã€ŒUsageã€

ã€è¡¨ç¤ºå†…å®¹ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœˆé–“ä½¿ç”¨é‡                               â”‚
â”‚                                          â”‚
â”‚ Dispatch: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 800/1000            â”‚
â”‚ åŒæ™‚å®Ÿè¡Œ: â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘ 3/10                â”‚
â”‚ APIå‘¼å‡º:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 500/1000            â”‚
â”‚                                          â”‚
â”‚ [ãƒ„ãƒ¼ãƒ«åˆ¥å†…è¨³] [æ—¥åˆ¥ã‚°ãƒ©ãƒ•]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. HitLæ‰¿èªã‚­ãƒ¥ãƒ¼

**ç¾çŠ¶**: APIã¯ä½œæˆæ¸ˆã¿ã ãŒUIãŒcontrol-n3ã«ãªã„

```
ã€ãƒ•ã‚¡ã‚¤ãƒ«ã€‘app/api/hitl/pending/route.ts

ã€çµ±åˆå…ˆã€‘control-n3ã®æ–°ã‚¿ãƒ–ã€ŒApprovalsã€

ã€è¡¨ç¤ºå†…å®¹ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¿èªå¾…ã¡ (3ä»¶)                           â”‚
â”‚                                          â”‚
â”‚ â˜ å‡ºå“æ‰¿èª: Product A    [æ‰¿èª] [å´ä¸‹]   â”‚
â”‚ â˜ ä¾¡æ ¼å¤‰æ›´: Product B    [æ‰¿èª] [å´ä¸‹]   â”‚
â”‚ â˜ åœ¨åº«æ›´æ–°: 50 items     [æ‰¿èª] [å´ä¸‹]   â”‚
â”‚                                          â”‚
â”‚ [ä¸€æ‹¬æ‰¿èª]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Supabase Schema

**ç¾çŠ¶**: SQLãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œæˆæ¸ˆã¿ã ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

```
ã€ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
- lib/tenant/schema.sql        # çµ„ç¹”ãƒ»ãƒ—ãƒ©ãƒ³ãƒ»ä½¿ç”¨é‡ãƒ†ãƒ¼ãƒ–ãƒ«
- lib/empire-os/migrations/    # HitLãƒ»ç›£æŸ»ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«

ã€å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«ã€‘
- organizationsï¼ˆçµ„ç¹”ï¼‰
- organization_membersï¼ˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰
- plansï¼ˆãƒ—ãƒ©ãƒ³ï¼‰
- usage_recordsï¼ˆä½¿ç”¨é‡ï¼‰
- api_keysï¼ˆAPIã‚­ãƒ¼ï¼‰
- user_actionsï¼ˆHitLæ‰¿èªã‚­ãƒ¥ãƒ¼ï¼‰
- audit_logsï¼ˆç›£æŸ»ãƒ­ã‚°ï¼‰
```

---

## ğŸ”§ çµ±åˆä½œæ¥­ã®æ‰‹é †

### Step 1: ãƒ˜ãƒƒãƒ€ãƒ¼ã«OrganizationSwitcherè¿½åŠ 

```tsx
// components/layout/header.tsx ã«è¿½åŠ 

import { OrganizationSwitcher } from '@/components/tenant';

// ãƒ˜ãƒƒãƒ€ãƒ¼å³å´ã«é…ç½®
<div className="flex items-center gap-4">
  <OrganizationSwitcher />  {/* â† è¿½åŠ  */}
  <UserMenu />
</div>
```

### Step 2: control-n3ã«Usageãƒ»HitLã‚¿ãƒ–è¿½åŠ 

```tsx
// control-n3ã®ã‚¿ãƒ–å®šç¾©ã«è¿½åŠ 

const TABS = [
  { id: 'monitor', label: 'Job Monitor', icon: Activity },
  { id: 'failed', label: 'Failed Jobs', icon: AlertTriangle },
  { id: 'metrics', label: 'Metrics', icon: TrendingUp },
  { id: 'usage', label: 'Usage', icon: BarChart3 },      // â† è¿½åŠ 
  { id: 'approvals', label: 'Approvals', icon: CheckCircle }, // â† è¿½åŠ 
  { id: 'status', label: 'System', icon: Server },
  { id: 'manual', label: 'Manual', icon: Terminal },
];
```

### Step 3: Supabase Schemaã‚’å®Ÿè¡Œ

```bash
# Supabase SQL Editorã§å®Ÿè¡Œ
# 1. lib/tenant/schema.sql
# 2. lib/empire-os/migrations/*.sql
```

---

## ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆä½œæˆæ¸ˆã¿ï¼‰

```
n3-frontend_new/
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ TenantContext.tsx          # âœ… çµ„ç¹”çŠ¶æ…‹ç®¡ç†
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ tenant/
â”‚       â”œâ”€â”€ OrganizationSwitcher.tsx  # âœ… çµ„ç¹”åˆ‡æ›¿UIï¼ˆæœªçµ±åˆï¼‰
â”‚       â”œâ”€â”€ UsageDashboard.tsx        # âœ… ä½¿ç”¨é‡UIï¼ˆæœªçµ±åˆï¼‰
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ onboarding/                # âœ… æ–°è¦ç™»éŒ²ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â””â”€â”€ onboarding-wizard.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ dispatch/              # âœ… ã‚¸ãƒ§ãƒ–API
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ jobs/route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ status/route.ts
â”‚   â”‚   â”‚   â””â”€â”€ kill-switch/route.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tenant/                # âœ… ãƒ†ãƒŠãƒ³ãƒˆAPI
â”‚   â”‚   â”‚   â”œâ”€â”€ organizations/route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ usage/route.ts
â”‚   â”‚   â”‚   â””â”€â”€ role/route.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ hitl/                  # âœ… HitL API
â”‚   â”‚       â”œâ”€â”€ approve/[actionCode]/route.ts
â”‚   â”‚       â”œâ”€â”€ reject/[actionCode]/route.ts
â”‚   â”‚       â””â”€â”€ pending/route.ts
â”‚   â”‚
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ workspace/page.tsx     # âœ… 5ã‚¿ãƒ–çµ±åˆç”»é¢
â”‚       â”œâ”€â”€ editing-n3/            # âœ… Catalog
â”‚       â”œâ”€â”€ research-n3/           # âœ… Sourcing
â”‚       â”œâ”€â”€ operations-n3/         # âœ… Execution
â”‚       â”œâ”€â”€ finance-n3/            # âœ… Finance
â”‚       â””â”€â”€ control-n3/            # âœ… Control
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ guards/                    # âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ rate-limiter.ts
â”‚   â”‚   â”œâ”€â”€ job-guard.ts
â”‚   â”‚   â”œâ”€â”€ billing-guard.ts
â”‚   â”‚   â”œâ”€â”€ rbac.ts
â”‚   â”‚   â”œâ”€â”€ webhook-firewall.ts
â”‚   â”‚   â””â”€â”€ api-key-manager.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ tenant/                    # âœ… ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tenant-service.ts
â”‚   â”‚   â”œâ”€â”€ schema.sql             # âš ï¸ è¦å®Ÿè¡Œ
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ empire-os/                 # âœ… å¸å›½OSåŸºç›¤
â”‚       â”œâ”€â”€ identity-manager.ts
â”‚       â”œâ”€â”€ policy-validator.ts
â”‚       â”œâ”€â”€ human-in-the-loop.ts
â”‚       â”œâ”€â”€ auth-gate.ts
â”‚       â””â”€â”€ migrations/            # âš ï¸ è¦å®Ÿè¡Œ
```

---

## ğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å„ªå…ˆåº¦1: UIã«è¡¨ç¤ºã•ã›ã‚‹ï¼ˆ5åˆ†ã§å®Œäº†ï¼‰

1. **ãƒ˜ãƒƒãƒ€ãƒ¼ã«OrganizationSwitcherè¿½åŠ **
2. **control-n3ã«Usageã‚¿ãƒ–è¿½åŠ **

### å„ªå…ˆåº¦2: DBã‚’æº–å‚™ã™ã‚‹ï¼ˆ10åˆ†ã§å®Œäº†ï¼‰

3. **Supabase SQLã‚’å®Ÿè¡Œ**

### å„ªå…ˆåº¦3: å‹•ä½œç¢ºèª

4. **çµ„ç¹”åˆ‡æ›¿ãŒå‹•ãã‹ç¢ºèª**
5. **ä½¿ç”¨é‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª**

---

ã©ã“ã‹ã‚‰é€²ã‚ã¾ã™ã‹ï¼Ÿ
