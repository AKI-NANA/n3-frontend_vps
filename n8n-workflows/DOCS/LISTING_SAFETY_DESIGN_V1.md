# N3 ãƒ‡ãƒ¼ã‚¿ç·¨é›†ã‚¿ãƒ– Ã— n8nå‡ºå“é€£æº å®‰å…¨è¨­è¨ˆæ›¸

**ä½œæˆæ—¥**: 2026-01-28
**å¯¾è±¡**: å‡ºå“ãƒ•ãƒ­ãƒ¼ï¼ˆUI â†’ Dispatch â†’ n8nï¼‰
**ç›®çš„**: èª¤å‡ºå“é˜²æ­¢ãƒ»äººé–“æ‰¿èªå¿…é ˆãƒ»KillSwitché€£å‹•ãƒ»å¤œé–“è‡ªå‹•å‡ºå“æ‹¡å¼µ

---

## ç¾çŠ¶åˆ†æ

### å‡ºå“é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

```sql
-- products_master ãƒ†ãƒ¼ãƒ–ãƒ«
workflow_status: VARCHAR  -- 'scraped'|'translated'|'sm_selected'|'audited'|'approved'|'listed'
approval_status: VARCHAR  -- 'pending'|'approved'|'rejected'|NULL
listing_status: VARCHAR   -- 'draft'|'active'|'ended'|'delisted'
ready_to_list: BOOLEAN    -- å‡ºå“æº–å‚™å®Œäº†ãƒ•ãƒ©ã‚°ï¼ˆæš—é»™çš„ï¼‰
scheduled_at: TIMESTAMP   -- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å‡ºå“æ—¥æ™‚
```

### ç¾åœ¨ã®UIâ†’n8nãƒ•ãƒ­ãƒ¼

```
[UI: å‡ºå“ãƒœã‚¿ãƒ³] 
    â†’ fetch('/api/n8n-proxy')
    â†’ n8n Webhook (n3-listing-local)
    â†’ eBay API
    â†’ callback â†’ DBæ›´æ–°
```

### å•é¡Œç‚¹

| å•é¡Œ | è©³ç´° | ãƒªã‚¹ã‚¯ |
|------|------|--------|
| æ‰¿èªãªã—å‡ºå“å¯èƒ½ | `ready_to_list` ãƒã‚§ãƒƒã‚¯ãŒUIå´ã®ã¿ | ğŸ”´ èª¤å‡ºå“ |
| KillSwitchæœªé€£å‹• | dispatchçµŒç”±ã ãŒKillSwitchç„¡åŠ¹ | ğŸ”´ ç·Šæ€¥åœæ­¢ä¸å¯ |
| æ¥½è¦³çš„APIå‘¼ã³å‡ºã— | ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãªã— | ğŸŸ  ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ |
| è‡ªå‹•å‡ºå“æœªå¯¾å¿œ | å¤œé–“ãƒãƒƒãƒæ©Ÿèƒ½ãªã— | ğŸŸ¡ æ©Ÿä¼šæå¤± |

---

## â‘  å‡ºå“çŠ¶æ…‹é·ç§»ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LISTING STATE MACHINE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚      SCRAPED        â”‚                            â”‚
â”‚                         â”‚    (åˆæœŸçŠ¶æ…‹)       â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚ [ç¿»è¨³å®Œäº†]                             â”‚
â”‚                                    â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚    TRANSLATED       â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚ [SMåˆ†æé–‹å§‹]                           â”‚
â”‚                                    â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚   SM_SEARCHING      â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚ [ç«¶åˆé¸æŠ]                             â”‚
â”‚                                    â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚    SM_SELECTED      â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚ [è©³ç´°å–å¾—]                             â”‚
â”‚                                    â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚  DETAILS_FETCHED    â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚ [AIè£œå®Œ]                               â”‚
â”‚                                    â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚      AUDITED        â”‚                            â”‚
â”‚                         â”‚    (ç›£æŸ»å®Œäº†)       â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â”‚ [å´ä¸‹]              â”‚ [äººé–“æ‰¿èª] â­       â”‚ [è‡ªå‹•æ‰¿èª]      â”‚
â”‚              â–¼                     â–¼                     â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    REJECTED     â”‚   â”‚     APPROVED        â”‚   â”‚  AUTO_APPROVED  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                        â”‚                        â”‚                â”‚
â”‚         â”‚                        â”‚ [å‡ºå“å®Ÿè¡Œ] â­          â”‚                â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                â”‚
â”‚         â”‚              â–¼         â–¼         â–¼              â”‚                â”‚
â”‚         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                â”‚
â”‚         â”‚     â”‚ LISTING â”‚  â”‚ SCHEDULEDâ”‚  â”‚LISTING_NOWâ”‚â—„â”€â”€â”€â”˜                â”‚
â”‚         â”‚     â”‚ QUEUED  â”‚  â”‚ (äºˆç´„)   â”‚  â”‚(å³æ™‚å‡ºå“) â”‚                     â”‚
â”‚         â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚          â”‚            â”‚ [æ™‚é–“åˆ°é”]   â”‚                           â”‚
â”‚         â”‚          â”‚            â–¼              â”‚                           â”‚
â”‚         â”‚          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                           â”‚
â”‚         â”‚          â””â”€â”€â”€â”€â–ºâ”‚  LISTING     â”‚â—„â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚         â”‚                â”‚  (å‡ºå“å‡¦ç†ä¸­) â”‚                                  â”‚
â”‚         â”‚                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚         â–¼             â–¼             â–¼                            â”‚
â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚   â”‚ LISTED  â”‚   â”‚  ERROR   â”‚  â”‚ PARTIAL  â”‚                      â”‚
â”‚         â”‚   â”‚(å‡ºå“å®Œäº†)â”‚   â”‚ (å¤±æ•—)  â”‚  â”‚ (éƒ¨åˆ†å¤±æ•—)â”‚                      â”‚
â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚         â”‚             â”‚             â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                   â–¼                                                         â”‚
â”‚            [ãƒ‡ãƒ¼ã‚¿ç·¨é›†ã¸æˆ»ã‚‹]                                               â”‚
â”‚                                                                             â”‚
â”‚  â­ = äººé–“ä»‹å…¥å¿…é ˆãƒã‚¤ãƒ³ãƒˆ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ…‹é·ç§»ãƒ«ãƒ¼ãƒ«å®Ÿè£…

```typescript
// lib/listing/state-machine.ts

export const LISTING_STATE_MACHINE = {
  transitions: {
    'scraped': ['translated'],
    'translated': ['sm_searching'],
    'sm_searching': ['sm_selected'],
    'sm_selected': ['details_fetched'],
    'details_fetched': ['audited'],
    'audited': ['approved', 'rejected', 'auto_approved'],
    'approved': ['listing_queued', 'scheduled', 'listing_now'],
    'auto_approved': ['listing_queued', 'scheduled', 'listing_now'],
    'listing_queued': ['listing'],
    'scheduled': ['listing'],
    'listing_now': ['listing'],
    'listing': ['listed', 'error', 'partial'],
    'error': ['translated', 'audited'],
    'partial': ['listed', 'error'],
    'rejected': ['translated'],
  },
  
  requiresHumanApproval: [
    'audited â†’ approved',
    'approved â†’ listing_now',
  ],
  
  autoTransitionAllowed: [
    'audited â†’ auto_approved',
    'approved â†’ scheduled',
    'scheduled â†’ listing',
  ],
};

export function canTransition(
  from: string,
  to: string,
  context: { isAutoApprovalEnabled: boolean; isHumanConfirmed: boolean }
): { allowed: boolean; reason?: string } {
  const allowedNextStates = LISTING_STATE_MACHINE.transitions[from];
  
  if (!allowedNextStates?.includes(to)) {
    return { allowed: false, reason: `${from} â†’ ${to} ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“` };
  }
  
  const transitionKey = `${from} â†’ ${to}`;
  if (LISTING_STATE_MACHINE.requiresHumanApproval.includes(transitionKey)) {
    if (!context.isHumanConfirmed) {
      return { allowed: false, reason: 'äººé–“ã®æ‰¿èªãŒå¿…è¦ã§ã™' };
    }
  }
  
  if (transitionKey === 'audited â†’ auto_approved') {
    if (!context.isAutoApprovalEnabled) {
      return { allowed: false, reason: 'è‡ªå‹•æ‰¿èªãŒç„¡åŠ¹ã§ã™' };
    }
  }
  
  return { allowed: true };
}
```

---

## â‘¡ UIæ“ä½œâ†’DBâ†’dispatchâ†’n8nãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LISTING FLOW DIAGRAM                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      1. UI LAYER                                    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [æ‰¿èªãƒœã‚¿ãƒ³] â†’ ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° â†’ [ç¢ºèª] â­ äººé–“æ‰¿èª                â”‚   â”‚
â”‚  â”‚  [å‡ºå“ãƒœã‚¿ãƒ³] â†’ å‡ºå“å…ˆé¸æŠ â†’ æœ€çµ‚ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« â†’ [å®Ÿè¡Œ] â­          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   2. VALIDATION LAYER                               â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Pre-flight Checks (Client):                                        â”‚   â”‚
â”‚  â”‚  â–¡ workflow_status === 'approved'                                   â”‚   â”‚
â”‚  â”‚  â–¡ listing_status !== 'active'                                      â”‚   â”‚
â”‚  â”‚  â–¡ profit > 0                                                       â”‚   â”‚
â”‚  â”‚  â–¡ physical_quantity > 0                                            â”‚   â”‚
â”‚  â”‚  â–¡ is_vero_brand === false                                          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Server Validation (API):                                           â”‚   â”‚
â”‚  â”‚  â–¡ å•†å“ãƒ‡ãƒ¼ã‚¿æœ€æ–°å–å¾—                                               â”‚   â”‚
â”‚  â”‚  â–¡ çŠ¶æ…‹é·ç§»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                                           â”‚   â”‚
â”‚  â”‚  â–¡ humanConfirmed ãƒ•ãƒ©ã‚°å¿…é ˆ                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   3. DISPATCH LAYER                                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  POST /api/dispatch                                                 â”‚   â”‚
â”‚  â”‚  {                                                                  â”‚   â”‚
â”‚  â”‚    "toolId": "listing-local",                                       â”‚   â”‚
â”‚  â”‚    "action": "list_now",                                            â”‚   â”‚
â”‚  â”‚    "params": { productIds, marketplace, account },                  â”‚   â”‚
â”‚  â”‚    "metadata": {                                                    â”‚   â”‚
â”‚  â”‚      "humanConfirmed": true,  â­ å¿…é ˆ                               â”‚   â”‚
â”‚  â”‚      "confirmationTimestamp": "..."                                 â”‚   â”‚
â”‚  â”‚    }                                                                â”‚   â”‚
â”‚  â”‚  }                                                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Guards:                                                            â”‚   â”‚
â”‚  â”‚  ğŸ”´ Kill Switch Check â†’ ON â†’ å³åº§ã«æ‹’å¦                            â”‚   â”‚
â”‚  â”‚  ğŸŸ  Concurrency Guard â†’ åŒæ™‚å®Ÿè¡Œåˆ¶é™                                â”‚   â”‚
â”‚  â”‚  ğŸŸ¡ Rate Limit â†’ 1æ™‚é–“1000ä»¶                                        â”‚   â”‚
â”‚  â”‚  âœ… Human Confirmation â†’ metadata.humanConfirmed å¿…é ˆ              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   4. DATABASE LAYER                                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Pre-Listing Update:                                                â”‚   â”‚
â”‚  â”‚  UPDATE products_master SET                                         â”‚   â”‚
â”‚  â”‚    workflow_status = 'listing',                                     â”‚   â”‚
â”‚  â”‚    listing_started_at = NOW(),                                      â”‚   â”‚
â”‚  â”‚    listing_metadata = { attempt, marketplace, humanConfirmedBy }    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Job Record:                                                        â”‚   â”‚
â”‚  â”‚  INSERT INTO listing_jobs (id, product_ids, status, human_confirmed)â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   5. N8N WORKFLOW LAYER                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Webhook: /webhook/n3-listing-local                                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Steps:                                                             â”‚   â”‚
â”‚  â”‚  1. ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼                                                  â”‚   â”‚
â”‚  â”‚  2. eBayãƒˆãƒ¼ã‚¯ãƒ³å–å¾—                                                â”‚   â”‚
â”‚  â”‚  3. å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—                                                  â”‚   â”‚
â”‚  â”‚  4. eBay AddItem APIå‘¼ã³å‡ºã—                                        â”‚   â”‚
â”‚  â”‚  5. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†                                                  â”‚   â”‚
â”‚  â”‚  6. DBæ›´æ–°ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯                                              â”‚   â”‚
â”‚  â”‚  7. ChatWorké€šçŸ¥                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   6. CALLBACK LAYER                                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  POST /api/n8n (callback)                                           â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Success:                                                           â”‚   â”‚
â”‚  â”‚  UPDATE products_master SET                                         â”‚   â”‚
â”‚  â”‚    workflow_status = 'listed',                                      â”‚   â”‚
â”‚  â”‚    listing_status = 'active',                                       â”‚   â”‚
â”‚  â”‚    ebay_item_id = 'xxx'                                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Failure:                                                           â”‚   â”‚
â”‚  â”‚  UPDATE products_master SET                                         â”‚   â”‚
â”‚  â”‚    workflow_status = 'error',                                       â”‚   â”‚
â”‚  â”‚    listing_error = { code, message }                                â”‚   â”‚
â”‚  â”‚  â†’ ChatWorkç·Šæ€¥é€šçŸ¥                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â‘¢ èª¤çˆ†é˜²æ­¢ã‚¬ãƒ¼ãƒ‰è¨­è¨ˆ

### å¤šå±¤é˜²å¾¡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
Layer 1: UI Validation (Client)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- æœªæ‰¿èªå•†å“ã¯å‡ºå“ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
- èµ¤å­—å•†å“ã«è­¦å‘Šè¡¨ç¤º
- VEROå¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ‰ã«è­¦å‘Šè¡¨ç¤º

Layer 2: Confirmation Dialog (UX)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- æ‰¿èªã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å¿…é ˆ
- å‡ºå“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: æœ€çµ‚ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«
- å¤§é‡å‡ºå“ï¼ˆ50ä»¶è¶…ï¼‰: è¿½åŠ è­¦å‘Š

Layer 3: API Validation (Server)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- å•†å“çŠ¶æ…‹ã®å†æ¤œè¨¼
- çŠ¶æ…‹é·ç§»ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
- humanConfirmed ãƒ•ãƒ©ã‚°å¿…é ˆ

Layer 4: Dispatch Guards
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Kill Switch ãƒã‚§ãƒƒã‚¯
- Rate Limit ãƒã‚§ãƒƒã‚¯
- Concurrency Guard
- ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²

Layer 5: n8n Workflow Guards
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ç½²åæ¤œè¨¼
- å•†å“ãƒ‡ãƒ¼ã‚¿æœ€çµ‚æ¤œè¨¼
- eBay API ã‚¨ãƒ©ãƒ¼æ™‚ã®å®‰å…¨åœæ­¢
```

### ã‚¬ãƒ¼ãƒ‰å®Ÿè£…

```typescript
// lib/guards/listing-guard.ts

export interface ListingGuardResult {
  allowed: boolean;
  blockers: ListingBlocker[];
  warnings: ListingWarning[];
}

export async function runListingGuards(
  ctx: ListingGuardContext
): Promise<ListingGuardResult> {
  const blockers: ListingBlocker[] = [];
  const warnings: ListingWarning[] = [];
  
  // ğŸ”´ BLOCKER: äººé–“ç¢ºèªå¿…é ˆ
  if (!ctx.humanConfirmed) {
    blockers.push({
      type: 'error',
      code: 'NO_HUMAN_CONFIRMATION',
      message: 'äººé–“ã«ã‚ˆã‚‹ç¢ºèªãŒå¿…è¦ã§ã™',
    });
  }
  
  // ğŸ”´ BLOCKER: æœªæ‰¿èªå•†å“
  const unapproved = ctx.products.filter(p => 
    p.workflow_status !== 'approved' && 
    p.workflow_status !== 'auto_approved'
  );
  if (unapproved.length > 0) {
    blockers.push({
      type: 'error',
      code: 'UNAPPROVED_PRODUCTS',
      message: `${unapproved.length}ä»¶ãŒæœªæ‰¿èªã§ã™`,
      productIds: unapproved.map(p => p.id),
    });
  }
  
  // ğŸ”´ BLOCKER: VEROé•å
  const veroProducts = ctx.products.filter(p => p.is_vero_brand === true);
  if (veroProducts.length > 0) {
    blockers.push({
      type: 'error',
      code: 'VERO_VIOLATION',
      message: `${veroProducts.length}ä»¶ãŒVEROå¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ‰ã§ã™`,
      productIds: veroProducts.map(p => p.id),
    });
  }
  
  // ğŸŸ¡ WARNING: èµ¤å­—å•†å“
  const negativeProfit = ctx.products.filter(p => (p.profit_amount_usd ?? 0) < 0);
  if (negativeProfit.length > 0) {
    warnings.push({
      type: 'warning',
      code: 'NEGATIVE_PROFIT',
      message: `${negativeProfit.length}ä»¶ãŒèµ¤å­—ã®å¯èƒ½æ€§`,
      productIds: negativeProfit.map(p => p.id),
      canOverride: true,
    });
  }
  
  // ğŸŸ¡ WARNING: åœ¨åº«0
  const outOfStock = ctx.products.filter(p => (p.physical_quantity ?? 0) === 0);
  if (outOfStock.length > 0) {
    warnings.push({
      type: 'warning',
      code: 'OUT_OF_STOCK',
      message: `${outOfStock.length}ä»¶ã®åœ¨åº«ãŒ0ã§ã™`,
      productIds: outOfStock.map(p => p.id),
      canOverride: false,
    });
  }
  
  return {
    allowed: blockers.length === 0,
    blockers,
    warnings,
  };
}
```

### Kill Switché€£å‹•

```typescript
// lib/guards/kill-switch.ts

export async function checkKillSwitch(
  toolId: string
): Promise<{ blocked: boolean; reason?: string }> {
  const { data } = await supabase
    .from('system_settings')
    .select('*')
    .eq('key', 'kill_switch')
    .single();
  
  if (!data?.value?.active) {
    return { blocked: false };
  }
  
  const state = data.value;
  
  if (state.scope === 'all') {
    return { blocked: true, reason: `ç·Šæ€¥åœæ­¢ä¸­: ${state.reason}` };
  }
  
  const toolCategory = toolId.split('-')[0];
  if (state.scope === toolCategory) {
    return { blocked: true, reason: `${state.scope}æ©Ÿèƒ½ãŒåœæ­¢ä¸­: ${state.reason}` };
  }
  
  return { blocked: false };
}
```

---

## â‘£ è‡ªå‹•å‡ºå“ON/OFF UIä»•æ§˜

### è¨­å®šç”»é¢UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è‡ªå‹•å‡ºå“è¨­å®š (Settings > Listing)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“‹ è‡ªå‹•æ‰¿èª                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [OFF] â”â”â”â”â—‹ [ON]  è‡ªå‹•æ‰¿èªã‚’æœ‰åŠ¹ã«ã™ã‚‹                   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  âš ï¸ ç›£æŸ»ã‚¹ã‚³ã‚¢90ç‚¹ä»¥ä¸Šã®å•†å“ãŒè‡ªå‹•æ‰¿èªã•ã‚Œã¾ã™            â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  æ¡ä»¶:                                                    â”‚  â”‚
â”‚  â”‚  â–¡ ç›£æŸ»ã‚¹ã‚³ã‚¢ 90ç‚¹ä»¥ä¸Š                                    â”‚  â”‚
â”‚  â”‚  â–¡ åˆ©ç›Šç‡ 15%ä»¥ä¸Š                                         â”‚  â”‚
â”‚  â”‚  â–¡ VEROãƒã‚§ãƒƒã‚¯åˆæ ¼                                       â”‚  â”‚
â”‚  â”‚  â–¡ Item Specificså®Œå‚™                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å‡ºå“                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [OFF] â”â”â”â”â—‹ [ON]  ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å‡ºå“ã‚’æœ‰åŠ¹ã«ã™ã‚‹           â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  å‡ºå“ã‚¿ã‚¤ãƒŸãƒ³ã‚°:                                          â”‚  â”‚
â”‚  â”‚  â—‹ æ¯æ—¥ 09:00 (æ—¥æœ¬æ™‚é–“)                                  â”‚  â”‚
â”‚  â”‚  â—‹ æ¯æ—¥ 21:00 (æ—¥æœ¬æ™‚é–“) â† ç±³å›½æ™‚é–“æœ                     â”‚  â”‚
â”‚  â”‚  â—‹ ã‚«ã‚¹ã‚¿ãƒ : [  :  ] ï½ [  :  ]                           â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  å‡ºå“ä¸Šé™: [ 100 ] ä»¶/æ—¥                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  ğŸš¨ ç·Šæ€¥åœæ­¢                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [ ğŸ”´ å…¨åœæ­¢ ]  [ ğŸŸ¡ å‡ºå“ã®ã¿åœæ­¢ ]  ç¾åœ¨: ğŸŸ¢ æ­£å¸¸        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  åœæ­¢ç†ç”±: [_________________________________]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚                                   [ ã‚­ãƒ£ãƒ³ã‚»ãƒ« ] [ ä¿å­˜ ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¨­å®šãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```typescript
// types/listing-settings.ts

export interface ListingSettings {
  autoApproval: {
    enabled: boolean;
    conditions: {
      minAuditScore: number;         // default: 90
      minProfitMargin: number;       // default: 0.15
      requireVeroCheck: boolean;     // default: true
      requireItemSpecifics: boolean; // default: true
    };
  };
  
  scheduledListing: {
    enabled: boolean;
    schedule: {
      type: 'preset' | 'custom';
      preset?: 'morning_jp' | 'evening_jp';
      customStart?: string;
      customEnd?: string;
      timezone: string;
    };
    dailyLimit: number;
  };
  
  killSwitch: {
    active: boolean;
    scope: 'all' | 'listing' | 'inventory' | 'research';
    reason?: string;
    activatedAt?: string;
    activatedBy?: string;
  };
}
```

---

## â‘¤ å°†æ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©æ¥ç¶šç‚¹

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCHEDULER ARCHITECTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     CRON TRIGGER (n8n)                              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Workflow: N3-SCHEDULE-CRON-COMPLETE                                â”‚   â”‚
â”‚  â”‚  Schedule: æ¯æ™‚å®Ÿè¡Œ (0 * * * *)                                     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Steps:                                                             â”‚   â”‚
â”‚  â”‚  1. ç¾åœ¨æ™‚åˆ»ãƒã‚§ãƒƒã‚¯                                                â”‚   â”‚
â”‚  â”‚  2. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šå–å¾—                                            â”‚   â”‚
â”‚  â”‚  3. å‡ºå“å¯¾è±¡å•†å“å–å¾— (workflow_status='approved')                   â”‚   â”‚
â”‚  â”‚  4. æ—¥æ¬¡ä¸Šé™ãƒã‚§ãƒƒã‚¯                                                â”‚   â”‚
â”‚  â”‚  5. å‡ºå“å®Ÿè¡Œ or ã‚¹ã‚­ãƒƒãƒ—                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     LISTING QUEUE TABLE                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  listing_queue:                                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ id: UUID                                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ product_id: INT (FK â†’ products_master)                         â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ scheduled_at: TIMESTAMP                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ priority: INT (1-10)                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ status: ENUM ('pending', 'processing', 'completed', 'failed')  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ marketplace: VARCHAR                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ account: VARCHAR                                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ created_at: TIMESTAMP                                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ processed_at: TIMESTAMP                                        â”‚   â”‚
â”‚  â”‚  â””â”€â”€ error_message: TEXT                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©æ¥ç¶šç”¨API

```typescript
// app/api/scheduler/listing/route.ts

/**
 * ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©æ¥ç¶šç‚¹
 * 
 * GET  /api/scheduler/listing/pending  - å‡ºå“å¾…ã¡å•†å“å–å¾—
 * POST /api/scheduler/listing/execute  - å‡ºå“å®Ÿè¡Œ
 * POST /api/scheduler/listing/complete - å®Œäº†é€šçŸ¥
 */

export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams;
  const limit = parseInt(searchParams.get('limit') || '100');
  
  // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šç¢ºèª
  const settings = await getListingSettings();
  if (!settings.scheduledListing.enabled) {
    return NextResponse.json({ products: [], message: 'Scheduled listing disabled' });
  }
  
  // Kill Switch ãƒã‚§ãƒƒã‚¯
  const killSwitch = await checkKillSwitch('listing');
  if (killSwitch.blocked) {
    return NextResponse.json({ products: [], message: killSwitch.reason });
  }
  
  // æ—¥æ¬¡ä¸Šé™ãƒã‚§ãƒƒã‚¯
  const todayCount = await getTodayListingCount();
  const remainingQuota = settings.scheduledListing.dailyLimit - todayCount;
  if (remainingQuota <= 0) {
    return NextResponse.json({ products: [], message: 'Daily limit reached' });
  }
  
  // å‡ºå“å¾…ã¡å•†å“å–å¾—
  const { data: products } = await supabase
    .from('products_master')
    .select('*')
    .in('workflow_status', ['approved', 'auto_approved'])
    .neq('listing_status', 'active')
    .limit(Math.min(limit, remainingQuota))
    .order('updated_at', { ascending: true });
  
  return NextResponse.json({
    products,
    quota: {
      daily: settings.scheduledListing.dailyLimit,
      used: todayCount,
      remaining: remainingQuota,
    },
  });
}

export async function POST(request: NextRequest) {
  const body = await request.json();
  const { productIds, marketplace, account } = body;
  
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if (!productIds?.length) {
    return NextResponse.json({ success: false, error: 'No products specified' }, { status: 400 });
  }
  
  // è‡ªå‹•å‡ºå“ç”¨ã®ç‰¹åˆ¥ãƒ•ãƒ©ã‚°
  const result = await dispatchWithKillSwitch('listing-local', 'list_now', {
    productIds,
    marketplace,
    account,
  }, {
    source: 'scheduler',          // UIã§ã¯ãªãã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
    humanConfirmed: false,        // äººé–“æ‰¿èªãªã—
    autoApprovalEnabled: true,    // è‡ªå‹•æ‰¿èªæœ‰åŠ¹å‰æ
  });
  
  return NextResponse.json(result);
}
```

### å°†æ¥ã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FUTURE EXTENSION POINTS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. å‹•çš„å„ªå…ˆåº¦è¨ˆç®—                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ priority_score = f(profit_margin, competition, seasonality, ...)  â”‚  â”‚
â”‚     â”‚ â†’ åˆ©ç›Šç‡é«˜ã„å•†å“ã‚’å„ªå…ˆå‡ºå“                                        â”‚  â”‚
â”‚     â”‚ â†’ ç«¶åˆãŒå°‘ãªã„å•†å“ã‚’å„ªå…ˆå‡ºå“                                      â”‚  â”‚
â”‚     â”‚ â†’ å­£ç¯€å•†å“ã‚’é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‡ºå“                                â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  2. ãƒãƒ«ãƒãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹å±•é–‹                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ eBay US â†’ eBay UK â†’ Amazon US â†’ ...                               â”‚  â”‚
â”‚     â”‚ â†’ å„ãƒãƒ¼ã‚±ãƒƒãƒˆã®æœ€é©æ™‚é–“å¸¯ã«è‡ªå‹•å‡ºå“                              â”‚  â”‚
â”‚     â”‚ â†’ åœ¨åº«é€£å‹•ï¼ˆ1ã¤å£²ã‚ŒãŸã‚‰å…¨ãƒãƒ¼ã‚±ãƒƒãƒˆåŒæœŸï¼‰                         â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  3. AIãƒ™ãƒ¼ã‚¹å‡ºå“æœ€é©åŒ–                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ â†’ éå»ã®è²©å£²ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æœ€é©ãªå‡ºå“ã‚¿ã‚¤ãƒŸãƒ³ã‚°å­¦ç¿’                    â”‚  â”‚
â”‚     â”‚ â†’ ä¾¡æ ¼èª¿æ•´ã®è‡ªå‹•åŒ–                                                â”‚  â”‚
â”‚     â”‚ â†’ ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜æ–‡ã®A/Bãƒ†ã‚¹ãƒˆ                                     â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  4. è‡ªå‹•å†å‡ºå“                                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ â†’ è½æœ­ã•ã‚Œãªã‹ã£ãŸå•†å“ã®è‡ªå‹•å†å‡ºå“                                â”‚  â”‚
â”‚     â”‚ â†’ ä¾¡æ ¼èª¿æ•´ãƒ«ãƒ¼ãƒ«é©ç”¨                                              â”‚  â”‚
â”‚     â”‚ â†’ å‡ºå“æœŸé–“æœ€é©åŒ–                                                  â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºç›¤æ•´å‚™ï¼ˆ2æ—¥ï¼‰

| Task | è©³ç´° | å„ªå…ˆåº¦ |
|------|------|--------|
| çŠ¶æ…‹é·ç§»æ©Ÿæ§‹ | `lib/listing/state-machine.ts` ä½œæˆ | ğŸ”´ é«˜ |
| ã‚¬ãƒ¼ãƒ‰å®Ÿè£… | `lib/guards/listing-guard.ts` ä½œæˆ | ğŸ”´ é«˜ |
| KillSwitché€£å‹• | `lib/guards/kill-switch.ts` ä½œæˆ | ğŸ”´ é«˜ |
| DBãƒ†ãƒ¼ãƒ–ãƒ« | `listing_jobs` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ | ğŸŸ  ä¸­ |

### Phase 2: UIæ”¹ä¿®ï¼ˆ2æ—¥ï¼‰

| Task | è©³ç´° | å„ªå…ˆåº¦ |
|------|------|--------|
| ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° | æ‰¿èªãƒ»å‡ºå“æ™‚ã®ç¢ºèªå¼·åŒ– | ğŸ”´ é«˜ |
| è­¦å‘Šè¡¨ç¤º | èµ¤å­—ãƒ»VEROãƒ»åœ¨åº«0ã®è­¦å‘ŠUI | ğŸŸ  ä¸­ |
| è¨­å®šç”»é¢ | è‡ªå‹•å‡ºå“è¨­å®šUI | ğŸŸ¡ ä½ |

### Phase 3: APIæ•´å‚™ï¼ˆ2æ—¥ï¼‰

| Task | è©³ç´° | å„ªå…ˆåº¦ |
|------|------|--------|
| Dispatchå¼·åŒ– | humanConfirmedå¿…é ˆåŒ– | ğŸ”´ é«˜ |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³API | `/api/listing/validate` | ğŸŸ  ä¸­ |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©API | `/api/scheduler/listing/*` | ğŸŸ¡ ä½ |

### Phase 4: n8né€£æºï¼ˆ1æ—¥ï¼‰

| Task | è©³ç´° | å„ªå…ˆåº¦ |
|------|------|--------|
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ›´æ–° | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼å¼·åŒ– | ğŸŸ  ä¸­ |
| ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æ•´å‚™ | ã‚¨ãƒ©ãƒ¼å‡¦ç†æ”¹å–„ | ğŸŸ  ä¸­ |
| CRONè¨­å®š | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | ğŸŸ¡ ä½ |

---

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å‡ºå“å‰ã«ç¢ºèªã™ã¹ãé …ç›®

```
â–¡ workflow_status ãŒ 'approved' ã¾ãŸã¯ 'auto_approved'
â–¡ listing_status ãŒ 'active' ã§ãªã„
â–¡ is_vero_brand ãŒ false
â–¡ profit_amount_usd > 0 ã¾ãŸã¯è­¦å‘Šç¢ºèªæ¸ˆã¿
â–¡ physical_quantity > 0
â–¡ äººé–“ã«ã‚ˆã‚‹æœ€çµ‚ç¢ºèªï¼ˆhumanConfirmed = trueï¼‰
â–¡ Kill Switch ãŒç„¡åŠ¹
â–¡ æ—¥æ¬¡å‡ºå“ä¸Šé™ã«é”ã—ã¦ã„ãªã„
```

### ç·Šæ€¥æ™‚ã®å¯¾å¿œ

```
1. Kill Switch ON
   â†’ Settings > Kill Switch > å…¨æ©Ÿèƒ½åœæ­¢ or å‡ºå“ã®ã¿åœæ­¢

2. èª¤å‡ºå“ç™ºç”Ÿæ™‚
   â†’ eBay Selling Manager ã‹ã‚‰å‡ºå“çµ‚äº†
   â†’ DB: listing_status = 'ended', workflow_status = 'error'
   â†’ ChatWork ã«ç·Šæ€¥é€šçŸ¥

3. å¤§é‡ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚
   â†’ n8n Executions ã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª
   â†’ Kill Switch ON
   â†’ åŸå› èª¿æŸ»
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

| é …ç›® | å¯¾ç­– |
|------|------|
| èªè¨¼ | Supabase Auth + JWTæ¤œè¨¼ |
| èªå¯ | humanConfirmedå¿…é ˆ + ãƒ­ãƒ¼ãƒ«ç¢ºèª |
| ç›£æŸ» | å…¨å‡ºå“æ“ä½œã‚’audit_logã«è¨˜éŒ² |
| æš—å·åŒ– | eBayãƒˆãƒ¼ã‚¯ãƒ³ã¯DBæš—å·åŒ– |
| ç½²å | n8n Webhook ã¯HMACç½²åæ¤œè¨¼ |
