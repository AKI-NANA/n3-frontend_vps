{
  "name": "ğŸ›ï¸ å¸å›½OS å¤œé–“è‡ªå¾‹é–‹ç™º",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 24
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "æ¯æ—¥ AM 3:00",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [240, 300],
      "notes": "æ¯æ—¥åˆå‰3æ™‚ã«è‡ªå¾‹é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ã‚’èµ·å‹•"
    },
    {
      "parameters": {
        "command": "cd /home/user/n3-frontend_new && node governance/nightly-autonomous-dev.js 2>&1",
        "timeout": 600
      },
      "id": "execute-autonomous-dev",
      "name": "ğŸ¤– è‡ªå¾‹é–‹ç™ºå®Ÿè¡Œ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [480, 300],
      "notes": "å¤œé–“è‡ªå¾‹é–‹ç™ºã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œï¼ˆæœ€å¤§10åˆ†ï¼‰"
    },
    {
      "parameters": {
        "filePath": "/home/user/n3-frontend_new/governance/nightly_result.json"
      },
      "id": "read-result",
      "name": "ğŸ“„ çµæœèª­ã¿è¾¼ã¿",
      "type": "n8n-nodes-base.readBinaryFiles",
      "typeVersion": 1,
      "position": [720, 300],
      "notes": "nightly_result.json ã‚’èª­ã¿è¾¼ã‚€"
    },
    {
      "parameters": {
        "jsCode": "// çµæœJSONã‚’ãƒ‘ãƒ¼ã‚¹\nconst resultJson = $input.first().json;\n\nlet latest = {};\ntry {\n  if (typeof resultJson === 'string') {\n    latest = JSON.parse(resultJson).latest || {};\n  } else if (resultJson.data) {\n    latest = JSON.parse(Buffer.from(resultJson.data).toString()).latest || {};\n  } else {\n    latest = resultJson.latest || resultJson;\n  }\n} catch (e) {\n  latest = { status: 'parse_error', error: e.message };\n}\n\n// Chatworkç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ\nconst statusEmoji = {\n  success: 'âœ…',\n  failed: 'âŒ',\n  no_task: 'ğŸ“­',\n  dry_run: 'ğŸ”®',\n  error: 'ğŸ’¥'\n};\n\nconst emoji = statusEmoji[latest.status] || 'â“';\n\nconst message = `[info][title]${emoji} å¸å›½OS å¤œé–“è‡ªå¾‹é–‹ç™ºãƒ¬ãƒãƒ¼ãƒˆ[/title]\nğŸ“… å®Ÿè¡Œæ—¥æ™‚: ${latest.timestamp || 'ä¸æ˜'}\nğŸ“ ã‚¿ã‚¹ã‚¯: ${latest.task_description || 'ãªã—'}\nğŸ“Š æœ€çµ‚ã‚¹ã‚³ã‚¢: ${latest.final_score || '-'}ç‚¹\nğŸ”„ ãƒªãƒˆãƒ©ã‚¤å›æ•°: ${latest.retry_count || 0}å›\nâ±ï¸ å®Ÿè¡Œæ™‚é–“: ${latest.duration_readable || '-'}\n\nğŸš€ æ˜‡æ ¼ãƒ•ã‚¡ã‚¤ãƒ«: ${(latest.promoted_files || []).length}ä»¶\n${(latest.promoted_files || []).slice(0, 5).map(f => '  â€¢ ' + f).join('\\n') || '  (ãªã—)'}\n\n${latest.errors && latest.errors.length > 0 ? 'âš ï¸ ã‚¨ãƒ©ãƒ¼:\\n' + latest.errors.slice(0, 3).join('\\n') : ''}[/info]`;\n\nreturn [{\n  json: {\n    message,\n    status: latest.status,\n    score: latest.final_score,\n    task: latest.task_key\n  }\n}];"
      },
      "id": "format-message",
      "name": "ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•´å½¢",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [960, 300],
      "notes": "Chatworké€šçŸ¥ç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ"
    },
    {
      "parameters": {
        "roomId": "={{ $env.CHATWORK_ROOM_ID }}",
        "body": "={{ $json.message }}"
      },
      "id": "chatwork-notify",
      "name": "ğŸ’¬ Chatworké€šçŸ¥",
      "type": "n8n-nodes-base.chatwork",
      "typeVersion": 1,
      "position": [1200, 300],
      "credentials": {
        "chatworkApi": {
          "id": "chatwork-credential-id",
          "name": "Chatwork API"
        }
      },
      "notes": "å®Ÿè¡Œçµæœã‚’Chatworkã¸é€šçŸ¥"
    }
  ],
  "connections": {
    "æ¯æ—¥ AM 3:00": {
      "main": [
        [
          {
            "node": "ğŸ¤– è‡ªå¾‹é–‹ç™ºå®Ÿè¡Œ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– è‡ªå¾‹é–‹ç™ºå®Ÿè¡Œ": {
      "main": [
        [
          {
            "node": "ğŸ“„ çµæœèª­ã¿è¾¼ã¿",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ çµæœèª­ã¿è¾¼ã¿": {
      "main": [
        [
          {
            "node": "ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•´å½¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•´å½¢": {
      "main": [
        [
          {
            "node": "ğŸ’¬ Chatworké€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveDataSuccessExecution": "all",
    "timezone": "Asia/Tokyo"
  },
  "staticData": null,
  "tags": [
    {
      "name": "å¸å›½OS",
      "color": "#F59E0B"
    },
    {
      "name": "è‡ªå¾‹é–‹ç™º",
      "color": "#22C55E"
    },
    {
      "name": "å¤œé–“ãƒãƒƒãƒ",
      "color": "#6366F1"
    }
  ],
  "meta": {
    "version": "1.0.0",
    "created_at": "2026-02-05",
    "description": "å¤œé–“ã«è‡ªå¾‹çš„ã«ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè£…ãƒ»ç›£æŸ»ãƒ»æ˜‡æ ¼ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼",
    "author": "N3 Empire OS"
  }
}
