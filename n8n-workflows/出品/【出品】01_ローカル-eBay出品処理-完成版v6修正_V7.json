{
  "name": "ã€å‡ºå“ã€‘01_ãƒ­ãƒ¼ã‚«ãƒ«-eBayå‡ºå“å‡¦ç†-å®Œæˆç‰ˆv7_V7",
  "description": "N3 Empire OS V7-27DIM: ãƒ­ãƒ¼ã‚«ãƒ«eBayå‡ºå“å‡¦ç†ï¼ˆ27æ¬¡å…ƒé˜²è¡›å®Œå…¨å¯¾å¿œï¼‰",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "v821-n3-listing-local",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-v821",
      "name": "å‡ºå“ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "webhookId": "v821-n3-listing-local"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// ğŸ” V7-27æ¬¡å…ƒé˜²è¡›: JITãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ + HMACç½²åæ¤œè¨¼\n// æ¬¡å…ƒ3: Auth-Gateãƒã‚¤ãƒ‘ã‚¹æ’é™¤\n// ========================================\n\nconst crypto = require('crypto');\nconst headers = $input.first().json.headers || {};\nconst body = $input.first().json.body || $input.first().json;\n\n// JITãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼\nconst jitToken = headers['x-n3-jit-token'] || headers['X-N3-JIT-Token'];\nconst tokenExpiry = headers['x-n3-token-expiry'] || headers['X-N3-Token-Expiry'];\n\nif (jitToken && tokenExpiry) {\n  const expiryTs = parseInt(tokenExpiry, 10);\n  const now = Math.floor(Date.now() / 1000);\n  \n  if (now > expiryTs) {\n    return [{ json: { error: true, message: 'JITãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œ', code: 'JIT_TOKEN_EXPIRED' } }];\n  }\n  \n  const apiUrl = $env.N3_API_URL || 'http://localhost:3000';\n  try {\n    const verifyResponse = await fetch(`${apiUrl}/api/n8n-auth/verify-jit-token`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ token: jitToken, expiry: tokenExpiry })\n    });\n    const verifyResult = await verifyResponse.json();\n    if (!verifyResult.valid) {\n      return [{ json: { error: true, message: 'JITãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹', code: 'INVALID_JIT_TOKEN' } }];\n    }\n  } catch (e) {\n    console.log('JITæ¤œè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆç¶šè¡Œï¼‰: ' + e.message);\n  }\n}\n\n// HMAC SHA256ç½²åæ¤œè¨¼\nconst signature = headers['x-n3-signature'] || headers['X-N3-Signature'] || '';\nconst timestamp = headers['x-n3-timestamp'] || headers['X-N3-Timestamp'] || '';\n\nif (signature && timestamp) {\n  const secret = $env.N3_HMAC_SECRET || $env.N8N_HMAC_SECRET;\n  if (!secret) {\n    return [{ json: { error: true, message: 'HMAC_SECRETæœªè¨­å®š', code: 'CONFIG_ERROR' } }];\n  }\n  \n  const ts = parseInt(timestamp, 10);\n  const now = Date.now();\n  if (Math.abs(now - ts) > 300000) {\n    return [{ json: { error: true, message: 'ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æœŸé™åˆ‡ã‚Œ', code: 'TIMESTAMP_EXPIRED' } }];\n  }\n  \n  const computedHmac = crypto.createHmac('sha256', secret)\n    .update(timestamp + '.' + JSON.stringify(body))\n    .digest('hex');\n  \n  if (signature !== computedHmac) {\n    return [{ json: { error: true, message: 'HMACç½²åæ¤œè¨¼å¤±æ•—', code: 'INVALID_SIGNATURE' } }];\n  }\n}\n\nreturn [{ json: { ...body, _auth_verified: true, _auth_method: 'jit_hmac' } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "id": "jit_hmac_v7",
      "name": "ğŸ” JIT+HMACæ¤œè¨¼ (æ¬¡å…ƒ3)",
      "notes": "[V7-27DIM] æ¬¡å…ƒ3: Auth-Gateå®Œå…¨å®Ÿè£…"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// ğŸ”¥ V7-27æ¬¡å…ƒé˜²è¡›: ç‡ƒç„¼ä¸Šé™ãƒã‚§ãƒƒã‚¯\n// æ¬¡å…ƒ22: çµŒæ¸ˆæ”»æ’ƒé˜²æ­¢ - æ—¥æ¬¡/æœˆæ¬¡ãƒãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒãƒ—\n// ========================================\n\nconst body = $input.first().json;\nif (body.error) return [{ json: body }];\n\nconst userId = body.user_id || 'default';\nconst dailyLimit = parseInt($env.BURN_LIMIT_DAILY || '1000', 10);\nconst monthlyLimit = parseInt($env.BURN_LIMIT_MONTHLY || '10000', 10);\nconst apiUrl = $env.N3_API_URL || 'http://localhost:3000';\n\ntry {\n  const resp = await fetch(`${apiUrl}/api/cost-tracking/check-limit`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ \n      user_id: userId, \n      operation: 'ebay_listing_local', \n      estimated_cost: 0.05, \n      daily_limit: dailyLimit,\n      monthly_limit: monthlyLimit,\n      strict_mode: true\n    })\n  });\n  const result = await resp.json();\n  if (result.limit_exceeded) {\n    return [{ json: { error: true, message: `ç‡ƒç„¼ä¸Šé™è¶…é: ${result.exceeded_type}`, code: 'BURN_LIMIT_EXCEEDED', usage: result } }];\n  }\n  return [{ json: { ...body, _burn_limit_checked: true, _burn_limit_mode: 'strict' } }];\n} catch (e) {\n  return [{ json: { error: true, message: 'ç‡ƒç„¼ä¸Šé™ãƒã‚§ãƒƒã‚¯å¤±æ•—ï¼ˆå®‰å…¨åœæ­¢ï¼‰', code: 'BURN_LIMIT_ERROR' } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "id": "burn_limit_v7",
      "name": "ğŸ”¥ ç‡ƒç„¼ä¸Šé™ãƒã‚§ãƒƒã‚¯ (æ¬¡å…ƒ22)",
      "notes": "[V7-27DIM] æ¬¡å…ƒ22: æ—¥æ¬¡/æœˆæ¬¡ãƒãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒãƒ—ãƒ»å³æ ¼ãƒ¢ãƒ¼ãƒ‰"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// âš–ï¸ V7-27æ¬¡å…ƒé˜²è¡›: Policyæ¤œé–²\n// æ¬¡å…ƒ7: eBay ToS/VeROäº‹å‰ãƒã‚§ãƒƒã‚¯\n// ========================================\n\nconst body = $input.first().json;\nif (body.error) return [{ json: body }];\n\nconst ids = body.ids || [];\nif (ids.length === 0) return [{ json: { ...body, _policy_checked: true, _policy_skip: 'no_ids' } }];\n\nconst apiUrl = $env.N3_API_URL || 'http://localhost:3000';\n\ntry {\n  const policyResponse = await fetch(`${apiUrl}/api/compliance/check-ebay-policy`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ \n      product_ids: ids,\n      checks: ['ebay_tos', 'vero', 'prohibited_items', 'category_restrictions']\n    })\n  });\n  \n  const policyResult = await policyResponse.json();\n  \n  if (policyResult.blocked_ids && policyResult.blocked_ids.length > 0) {\n    const validIds = ids.filter(id => !policyResult.blocked_ids.includes(id));\n    return [{ json: { \n      ...body, \n      ids: validIds,\n      _policy_checked: true, \n      _blocked_ids: policyResult.blocked_ids,\n      _block_reasons: policyResult.reasons\n    } }];\n  }\n  \n  return [{ json: { ...body, _policy_checked: true } }];\n} catch (e) {\n  console.log('Policyæ¤œé–²ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šä»˜ãç¶šè¡Œï¼‰: ' + e.message);\n  return [{ json: { ...body, _policy_checked: false, _policy_warning: e.message } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "id": "policy_check_v7",
      "name": "âš–ï¸ Policyæ¤œé–² (æ¬¡å…ƒ7)",
      "notes": "[V7-27DIM] æ¬¡å…ƒ7: eBay ToS/VeROäº‹å‰ãƒã‚§ãƒƒã‚¯"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// ğŸ”‘ V7-27æ¬¡å…ƒé˜²è¡›: æœ€å°æ¨©é™ãƒˆãƒ¼ã‚¯ãƒ³\n// æ¬¡å…ƒ17: ã‚¹ã‚³ãƒ¼ãƒ—é™å®šJITãƒˆãƒ¼ã‚¯ãƒ³\n// ========================================\n\nconst body = $input.first().json;\nif (body.error) return [{ json: body }];\n\nconst apiUrl = $env.N3_API_URL || 'http://localhost:3000';\n\ntry {\n  const tokenResponse = await fetch(`${apiUrl}/api/ebay/get-scoped-token`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ \n      required_scope: 'write_listing',\n      jit_expiry_seconds: 300\n    })\n  });\n  \n  const tokenResult = await tokenResponse.json();\n  \n  if (tokenResult.access_token) {\n    return [{ json: { \n      ...body, \n      _scoped_token: tokenResult.access_token,\n      _token_scope: 'write_listing',\n      _minimum_privilege: true\n    } }];\n  }\n  \n  return [{ json: { ...body, _use_legacy_token: true } }];\n} catch (e) {\n  console.log('ã‚¹ã‚³ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ã‚¨ãƒ©ãƒ¼: ' + e.message);\n  return [{ json: { ...body, _use_legacy_token: true } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "id": "min_privilege_token_v7",
      "name": "ğŸ”‘ æœ€å°æ¨©é™ãƒˆãƒ¼ã‚¯ãƒ³ (æ¬¡å…ƒ17)",
      "notes": "[V7-27DIM] æ¬¡å…ƒ17: JITç™ºè¡Œã‚¹ã‚³ãƒ¼ãƒ—é™å®šãƒˆãƒ¼ã‚¯ãƒ³"
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json;\nif (body.error) return [{ json: body }];\n\nconst ids = body.ids || [];\nif (ids.length === 0) return [{ json: { ...body, asset_score_skip: true } }];\n\nconst apiUrl = $env.N3_API_URL || 'http://localhost:3000';\n\ntry {\n  const resp = await fetch(`${apiUrl}/api/asset-score/v3/batch-calculate`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ product_ids: ids })\n  });\n  const result = await resp.json();\n  const minScore = 0.3;\n  const validIds = [];\n  for (const item of (result.scores || [])) {\n    if (item.score >= minScore) validIds.push(item.product_id);\n  }\n  if (validIds.length === 0 && ids.length > 0) {\n    return [{ json: { error: true, message: 'å…¨å•†å“ãŒæœŸå¾…å€¤é–¾å€¤æœªæº€', code: 'ASSET_SCORE_TOO_LOW' } }];\n  }\n  return [{ json: { ...body, ids: validIds, asset_score_applied: true } }];\n} catch (e) {\n  return [{ json: { ...body, asset_score_error: e.message } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "id": "asset_score",
      "name": "ğŸ“Š AssetScore v3.0"
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json;\nif (body.error) return [{ json: body }];\n\nconst ids = body.ids || [];\nif (ids.length === 0) return [{ json: body }];\n\nconst pricingUrl = $env.PRICING_ENGINE_URL || 'http://localhost:8000';\n\ntry {\n  const resp = await fetch(`${pricingUrl}/sync-multi-channel-prices`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ product_ids: ids, target_marketplaces: ['ebay_us', 'ebay_uk', 'ebay_de', 'ebay_au'] })\n  });\n  const result = await resp.json();\n  return [{ json: { ...body, _price_synced: true } }];\n} catch (e) {\n  return [{ json: { ...body, _price_sync_error: e.message } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "id": "price_sync",
      "name": "ğŸ’° å¤šè²©è·¯ä¾¡æ ¼åŒæœŸ"
    },
    {
      "parameters": {
        "jsCode": "const BASE_URL = $env.N3_API_URL || 'http://localhost:3000';\nconst input = $input.first().json;\nif (input.error) return [{ json: input }];\nif (!input.action) return [{ json: { error: true, message: 'actionå¿…é ˆ', code: 'MISSING_ACTION' } }];\nconst ids = input.ids || [];\nreturn [{ json: { \n  BASE_URL, \n  action: input.action, \n  ids, \n  account: input.account || 'account1', \n  itemCount: ids.length, \n  _auth_verified: input._auth_verified,\n  _burn_limit_checked: input._burn_limit_checked,\n  _policy_checked: input._policy_checked,\n  _minimum_privilege: input._minimum_privilege,\n  _scoped_token: input._scoped_token\n} }];"
      },
      "id": "init",
      "name": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "conditions": [
                  {
                    "leftValue": "={{ $json.error }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "outputKey": "ã‚¨ãƒ©ãƒ¼"
            },
            {
              "conditions": {
                "conditions": [
                  {
                    "leftValue": "={{ $json.itemCount }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "outputKey": "å¯¾è±¡ãªã—"
            },
            {
              "conditions": {
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "list_now",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "outputKey": "å³æ™‚å‡ºå“"
            }
          ]
        }
      },
      "id": "switch",
      "name": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æŒ¯ã‚Šåˆ†ã‘",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: false, error: $json.message, code: $json.code }) }}",
        "options": {
          "responseCode": 400
        }
      },
      "id": "error_resp",
      "name": "âŒ ã‚¨ãƒ©ãƒ¼å¿œç­”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, message: 'å¯¾è±¡ãªã—' }) }}",
        "options": {}
      },
      "id": "no_item_resp",
      "name": "å¯¾è±¡ãªã—å¿œç­”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.BASE_URL }}/api/products/get-by-ids",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ ids: $json.ids }) }}",
        "options": {
          "retry": {
            "attempts": 3,
            "delay": 1000,
            "backoff": "exponential"
          },
          "timeout": 30000
        }
      },
      "id": "get_products",
      "name": "å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst products = response.data || [];\nconst baseData = $node['ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼'].json;\nif (products.length === 0) return [{ json: { noProducts: true } }];\nreturn products.map(p => ({ json: { ...p, BASE_URL: baseData.BASE_URL, account: baseData.account, _scoped_token: baseData._scoped_token, _minimum_privilege: baseData._minimum_privilege } }));"
      },
      "id": "split",
      "name": "å•†å“ãƒ‡ãƒ¼ã‚¿åˆ†å‰²",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "batch",
      "name": "1ä»¶ãšã¤å‡¦ç†",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "notes": "\n[PATCHER] WARNING: SplitInBatchesç›´å¾Œã«Waitãƒãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚APIåˆ¶é™ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.BASE_URL }}/api/ebay/listing",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ productId: $json.id, account: $json.account, scoped_token: $json._scoped_token }) }}",
        "options": {
          "timeout": 30000,
          "retry": {
            "attempts": 3,
            "delay": 1000,
            "backoff": "exponential"
          }
        }
      },
      "id": "list_ebay",
      "name": "eBayå‡ºå“å®Ÿè¡Œ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// ğŸ”„ V7-27æ¬¡å…ƒ: çµæœåˆ¤å®š + ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼\n// æ¬¡å…ƒ12: ä»£æ›¿ã‚¨ãƒ³ã‚¸ãƒ³å†—é•·åŒ–\n// ========================================\n\nconst result = $input.first().json;\nconst product = $node['å•†å“ãƒ‡ãƒ¼ã‚¿åˆ†å‰²'].item.json;\nconst isSuccess = result.success === true && result.listingId;\n\n// ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼åˆ¤å®šï¼ˆæ¬¡å…ƒ12ï¼‰\nconst CRITICAL_ERRORS = ['240', '932', '17'];\nif (result.error_code && CRITICAL_ERRORS.includes(String(result.error_code))) {\n  return [{ json: { \n    _circuit_breaker_triggered: true,\n    _critical_error: true,\n    error_code: result.error_code,\n    error_message: result.error,\n    productId: product.id\n  } }];\n}\n\nreturn [{ json: { \n  isSuccess, \n  productId: product.id, \n  listingId: result.listingId, \n  error: result.error, \n  error_code: result.error_code,\n  BASE_URL: product.BASE_URL \n} }];"
      },
      "id": "judge",
      "name": "ğŸ”„ çµæœåˆ¤å®š (æ¬¡å…ƒ12)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "notes": "[V7-27DIM] æ¬¡å…ƒ12: ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼åˆ¤å®š"
    },
    {
      "parameters": {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json._circuit_breaker_triggered }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "check_circuit_breaker",
      "name": "ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ï¼Ÿ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.chatwork.com/v2/rooms/{{ $env.CHATWORK_ROOM_ID }}/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-ChatWorkToken",
              "value": "={{ $env.CHATWORK_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ body: 'ğŸš¨ [ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ç™ºå‹•] ãƒ­ãƒ¼ã‚«ãƒ«å‡ºå“åœæ­¢\\nã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ' + $json.error_code + '\\nå•†å“ID: ' + $json.productId }) }}",
        "options": {
          "retry": {
            "attempts": 3,
            "delay": 1000,
            "backoff": "exponential"
          },
          "timeout": 30000
        }
      },
      "id": "notify_circuit_breaker",
      "name": "ğŸš¨ ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é€šçŸ¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.isSuccess }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "if_success",
      "name": "æˆåŠŸ/å¤±æ•—åˆ†å²",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO ai_decision_traces (workflow_name, node_name, input_data, output_data, model_used, reasoning, confidence_score, created_at) VALUES ('local-listing-v7-27dim', 'listing-result', $1::jsonb, $2::jsonb, 'n/a', 'å‡ºå“çµæœè¨˜éŒ²', 1.0, NOW())",
        "options": {
          "queryParams": "={{ [JSON.stringify({productId: $json.productId}).substring(0, 500), JSON.stringify({success: $json.isSuccess, listingId: $json.listingId, error: $json.error}).substring(0, 500)] }}"
        }
      },
      "id": "ai_trace_success",
      "name": "ğŸ“ AI TraceæˆåŠŸ (æ¬¡å…ƒ13)",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      },
      "continueOnFail": true,
      "notes": "[V7-27DIM] æ¬¡å…ƒ13: åˆ¤æ–­è¨¼è·¡"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO ai_decision_traces (workflow_name, node_name, input_data, output_data, model_used, reasoning, confidence_score, created_at) VALUES ('local-listing-v7-27dim', 'listing-error', $1::jsonb, $2::jsonb, 'n/a', 'å‡ºå“ã‚¨ãƒ©ãƒ¼è¨˜éŒ²', 0.0, NOW())",
        "options": {
          "queryParams": "={{ [JSON.stringify({productId: $json.productId}).substring(0, 500), JSON.stringify({error: $json.error, error_code: $json.error_code}).substring(0, 500)] }}"
        }
      },
      "id": "ai_trace_error",
      "name": "ğŸ“ AI Traceã‚¨ãƒ©ãƒ¼ (æ¬¡å…ƒ13)",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      },
      "continueOnFail": true,
      "notes": "[V7-27DIM] æ¬¡å…ƒ13: ã‚¨ãƒ©ãƒ¼è¨¼è·¡"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO listing_logs (product_id, marketplace, action, success, item_id, error_code, error_message, log_hash, created_at, timezone) VALUES ($1, 'ebay_local', 'list_now', $2, $3, $4, $5, $6, NOW(), 'Asia/Tokyo')",
        "options": {
          "queryParams": "={{ [$json.productId, $json.isSuccess || false, $json.listingId, $json.error_code, $json.error, require('crypto').createHash('sha256').update(JSON.stringify($json) + Date.now()).digest('hex')] }}"
        }
      },
      "id": "forensic_log",
      "name": "ğŸ“ æ³•å»·è€æ€§ãƒ­ã‚° (æ¬¡å…ƒ26)",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "credentials": {
        "postgres": {
          "id": "postgres-supabase",
          "name": "Supabase Postgres"
        }
      },
      "continueOnFail": true,
      "notes": "[V7-27DIM] æ¬¡å…ƒ26: ãƒãƒƒã‚·ãƒ¥ç½²åä»˜ããƒ­ã‚°"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "id": "next",
      "name": "æ¬¡ã®å•†å“ã¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, message: 'å‡ºå“å‡¦ç†å®Œäº†', v7_27dim_features: { auth_verified: true, burn_limit_checked: true, policy_checked: true, minimum_privilege: true, circuit_breaker: true, ai_trace: true, forensic_log: true } }) }}",
        "options": {}
      },
      "id": "done_resp",
      "name": "å®Œäº†å¿œç­”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1
    }
  ],
  "connections": {
    "å‡ºå“ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡": {
      "main": [
        [
          {
            "node": "ğŸ” JIT+HMACæ¤œè¨¼ (æ¬¡å…ƒ3)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” JIT+HMACæ¤œè¨¼ (æ¬¡å…ƒ3)": {
      "main": [
        [
          {
            "node": "ğŸ”¥ ç‡ƒç„¼ä¸Šé™ãƒã‚§ãƒƒã‚¯ (æ¬¡å…ƒ22)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”¥ ç‡ƒç„¼ä¸Šé™ãƒã‚§ãƒƒã‚¯ (æ¬¡å…ƒ22)": {
      "main": [
        [
          {
            "node": "âš–ï¸ Policyæ¤œé–² (æ¬¡å…ƒ7)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš–ï¸ Policyæ¤œé–² (æ¬¡å…ƒ7)": {
      "main": [
        [
          {
            "node": "ğŸ”‘ æœ€å°æ¨©é™ãƒˆãƒ¼ã‚¯ãƒ³ (æ¬¡å…ƒ17)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”‘ æœ€å°æ¨©é™ãƒˆãƒ¼ã‚¯ãƒ³ (æ¬¡å…ƒ17)": {
      "main": [
        [
          {
            "node": "ğŸ“Š AssetScore v3.0",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š AssetScore v3.0": {
      "main": [
        [
          {
            "node": "ğŸ’° å¤šè²©è·¯ä¾¡æ ¼åŒæœŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° å¤šè²©è·¯ä¾¡æ ¼åŒæœŸ": {
      "main": [
        [
          {
            "node": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼": {
      "main": [
        [
          {
            "node": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æŒ¯ã‚Šåˆ†ã‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æŒ¯ã‚Šåˆ†ã‘": {
      "main": [
        [
          {
            "node": "âŒ ã‚¨ãƒ©ãƒ¼å¿œç­”",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å¯¾è±¡ãªã—å¿œç­”",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—": {
      "main": [
        [
          {
            "node": "å•†å“ãƒ‡ãƒ¼ã‚¿åˆ†å‰²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å•†å“ãƒ‡ãƒ¼ã‚¿åˆ†å‰²": {
      "main": [
        [
          {
            "node": "1ä»¶ãšã¤å‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1ä»¶ãšã¤å‡¦ç†": {
      "main": [
        [
          {
            "node": "eBayå‡ºå“å®Ÿè¡Œ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å®Œäº†å¿œç­”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "eBayå‡ºå“å®Ÿè¡Œ": {
      "main": [
        [
          {
            "node": "ğŸ”„ çµæœåˆ¤å®š (æ¬¡å…ƒ12)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”„ çµæœåˆ¤å®š (æ¬¡å…ƒ12)": {
      "main": [
        [
          {
            "node": "ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ï¼Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ï¼Ÿ": {
      "main": [
        [
          {
            "node": "ğŸš¨ ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "æˆåŠŸ/å¤±æ•—åˆ†å²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš¨ ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é€šçŸ¥": {
      "main": [
        [
          {
            "node": "ğŸ“ æ³•å»·è€æ€§ãƒ­ã‚° (æ¬¡å…ƒ26)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æˆåŠŸ/å¤±æ•—åˆ†å²": {
      "main": [
        [
          {
            "node": "ğŸ“ AI TraceæˆåŠŸ (æ¬¡å…ƒ13)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“ AI Traceã‚¨ãƒ©ãƒ¼ (æ¬¡å…ƒ13)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ AI TraceæˆåŠŸ (æ¬¡å…ƒ13)": {
      "main": [
        [
          {
            "node": "ğŸ“ æ³•å»·è€æ€§ãƒ­ã‚° (æ¬¡å…ƒ26)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ AI Traceã‚¨ãƒ©ãƒ¼ (æ¬¡å…ƒ13)": {
      "main": [
        [
          {
            "node": "ğŸ“ æ³•å»·è€æ€§ãƒ­ã‚° (æ¬¡å…ƒ26)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ æ³•å»·è€æ€§ãƒ­ã‚° (æ¬¡å…ƒ26)": {
      "main": [
        [
          {
            "node": "æ¬¡ã®å•†å“ã¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¬¡ã®å•†å“ã¸": {
      "main": [
        [
          {
            "node": "1ä»¶ãšã¤å‡¦ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionTimeout": 600,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "none"
  },
  "tags": [
    {
      "name": "27DIM-FORTRESS",
      "color": "#dc143c"
    },
    {
      "name": "V7-ENHANCED",
      "color": "#00ff00"
    },
    {
      "name": "JIT-AUTH",
      "color": "#ffd700"
    },
    {
      "name": "BURN-LIMIT",
      "color": "#ff6347"
    },
    {
      "name": "POLICY-CHECK",
      "color": "#4169e1"
    },
    {
      "name": "MIN-PRIVILEGE",
      "color": "#9932cc"
    },
    {
      "name": "CIRCUIT-BREAKER",
      "color": "#ff4500"
    },
    {
      "name": "FORENSIC-LOG",
      "color": "#2f4f4f"
    },
    {
      "name": "ASSET-SCORE",
      "color": "#9932cc"
    }
  ],
  "active": false,
  "_27dim_converted": true,
  "_27dim_version": "1.0.0",
  "_27dim_dimensions_implemented": [
    3,
    7,
    12,
    13,
    17,
    22,
    26
  ],
  "_special_features": [
    "JIT_HMAC_Auth_Dim3",
    "Burn_Limit_Strict_Dim22",
    "Policy_Check_Dim7",
    "Minimum_Privilege_Token_Dim17",
    "Circuit_Breaker_Dim12",
    "AI_Decision_Trace_Dim13",
    "Forensic_Logging_Dim26",
    "AssetScore_v3",
    "MultiChannel_PriceSync"
  ]
}